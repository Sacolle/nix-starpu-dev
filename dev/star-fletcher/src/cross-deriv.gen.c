/*
    Este é um arquivo gerado automaticamente pelo script `cross-deriv-gen.py`
    A meta é lidar discernir os casos antes da computação, de forma que na hora do cáculo, 
    este possa tomar uma forma idêntica a do fletcher base.
          
    Na pipeline de compilação, ele é incluido no arquivo derivatives.c, que diferencia os casos
    entre os nove quadrantes definidos
*/
#include <assert.h>
          
#ifdef RELEASE        
#define UNREACHABLE __builtin_unreachable()
#else
#define UNREACHABLE assert(0 && "Unreachable!"); return 0.0
#endif
          
#include "floatingpoint.h"
#include "derivatives.h"
          
#define MAX_MASK_NUM 4


FP cross_deriv_neg_neg(
    const FP* block, const size_t base_idx,
    const size_t dir1, const FP* block_neg_center, const FP* block_pos_center, const int stride1,
    const size_t dir2, const FP* block_center_neg, const FP* block_center_pos, const int stride2,
    const FP* block_pos_pos, const FP* block_pos_neg, 
    const FP* block_neg_pos, const FP* block_neg_neg,
    const int cube_width, const FP dinv
){	
	const int depth1 = dir1;
	const size_t border_idx_1 = flip(0, base_idx - depth1 * stride1, stride1, cube_width);
	
	const int depth2 = dir2;
	const size_t border_idx_2 = flip(0, base_idx - depth2 * stride2, stride2, cube_width);
	
	const size_t border_idx_3 = flip(0, border_idx_1 - depth2 * stride2, stride2, cube_width);
    switch (BITMASK_PAIR(depth1, depth2)){
    case BITMASK_PAIR(0, 0):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (0 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (1 * stride2)]+block_neg_neg[border_idx_3 + (0 * stride1) + (0 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (1 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (2 * stride2)]+block_neg_neg[border_idx_3 + (0 * stride1) + (1 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (0 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (1 * stride2)]+block_neg_neg[border_idx_3 + (1 * stride1) + (0 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (2 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (3 * stride2)]+block_neg_neg[border_idx_3 + (0 * stride1) + (2 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (0 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (1 * stride2)]+block_neg_neg[border_idx_3 + (2 * stride1) + (0 * stride2)])+
		    L14*(block[base_idx + (1 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (3 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (4 * stride2)]+block_neg_neg[border_idx_3 + (0 * stride1) + (3 * stride2)]+block[base_idx + (4 * stride1) + (1 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (0 * stride2)]-block_neg_center[border_idx_1 + (3 * stride1) + (1 * stride2)]+block_neg_neg[border_idx_3 + (3 * stride1) + (0 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (1 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (2 * stride2)]+block_neg_neg[border_idx_3 + (1 * stride1) + (1 * stride2)])+
		    L23*(block[base_idx + (2 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (2 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (3 * stride2)]+block_neg_neg[border_idx_3 + (1 * stride1) + (2 * stride2)]+block[base_idx + (3 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (1 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (2 * stride2)]+block_neg_neg[border_idx_3 + (2 * stride1) + (1 * stride2)])+ 
		    L24*(block[base_idx + (2 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (3 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (4 * stride2)]+block_neg_neg[border_idx_3 + (1 * stride1) + (3 * stride2)]+block[base_idx + (4 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (1 * stride2)]-block_neg_center[border_idx_1 + (3 * stride1) + (2 * stride2)]+block_neg_neg[border_idx_3 + (3 * stride1) + (1 * stride2)])+ 
		    L33*(block[base_idx + (3 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (2 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (3 * stride2)]+block_neg_neg[border_idx_3 + (2 * stride1) + (2 * stride2)])+
		    L34*(block[base_idx + (3 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (3 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (4 * stride2)]+block_neg_neg[border_idx_3 + (2 * stride1) + (3 * stride2)]+block[base_idx + (4 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (2 * stride2)]-block_neg_center[border_idx_1 + (3 * stride1) + (3 * stride2)]+block_neg_neg[border_idx_3 + (3 * stride1) + (2 * stride2)])+
		    L44*(block[base_idx + (4 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (3 * stride2)]-block_neg_center[border_idx_1 + (3 * stride1) + (4 * stride2)]+block_neg_neg[border_idx_3 + (3 * stride1) + (3 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(0, 1):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (0 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (2 * stride2)]+block_neg_neg[border_idx_3 + (0 * stride1) + (0 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-1 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (1 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (3 * stride2)]+block_neg_neg[border_idx_3 + (0 * stride1) + (1 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-1 * stride2)])+
		    L14*(block[base_idx + (1 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (2 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (4 * stride2)]+block_neg_neg[border_idx_3 + (0 * stride1) + (2 * stride2)]+block[base_idx + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (3 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (3 * stride1) + (-1 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (0 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (2 * stride2)]+block_neg_neg[border_idx_3 + (1 * stride1) + (0 * stride2)])+
		    L23*(block[base_idx + (2 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (1 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (3 * stride2)]+block_neg_neg[border_idx_3 + (1 * stride1) + (1 * stride2)]+block[base_idx + (3 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (0 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (2 * stride2)]+block_neg_neg[border_idx_3 + (2 * stride1) + (0 * stride2)])+ 
		    L24*(block[base_idx + (2 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (2 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (4 * stride2)]+block_neg_neg[border_idx_3 + (1 * stride1) + (2 * stride2)]+block[base_idx + (4 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (0 * stride2)]-block_neg_center[border_idx_1 + (3 * stride1) + (2 * stride2)]+block_neg_neg[border_idx_3 + (3 * stride1) + (0 * stride2)])+ 
		    L33*(block[base_idx + (3 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (1 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (3 * stride2)]+block_neg_neg[border_idx_3 + (2 * stride1) + (1 * stride2)])+
		    L34*(block[base_idx + (3 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (2 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (4 * stride2)]+block_neg_neg[border_idx_3 + (2 * stride1) + (2 * stride2)]+block[base_idx + (4 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (1 * stride2)]-block_neg_center[border_idx_1 + (3 * stride1) + (3 * stride2)]+block_neg_neg[border_idx_3 + (3 * stride1) + (1 * stride2)])+
		    L44*(block[base_idx + (4 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (2 * stride2)]-block_neg_center[border_idx_1 + (3 * stride1) + (4 * stride2)]+block_neg_neg[border_idx_3 + (3 * stride1) + (2 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(0, 2):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-2 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-1 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (0 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (3 * stride2)]+block_neg_neg[border_idx_3 + (0 * stride1) + (0 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-1 * stride2)])+
		    L14*(block[base_idx + (1 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (1 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (4 * stride2)]+block_neg_neg[border_idx_3 + (0 * stride1) + (1 * stride2)]+block[base_idx + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (3 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (3 * stride1) + (-1 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-2 * stride2)])+
		    L23*(block[base_idx + (2 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (0 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (3 * stride2)]+block_neg_neg[border_idx_3 + (1 * stride1) + (0 * stride2)]+block[base_idx + (3 * stride1) + (2 * stride2)]-block[base_idx + (3 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-2 * stride2)])+ 
		    L24*(block[base_idx + (2 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (1 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (4 * stride2)]+block_neg_neg[border_idx_3 + (1 * stride1) + (1 * stride2)]+block[base_idx + (4 * stride1) + (2 * stride2)]-block[base_idx + (4 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (3 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (3 * stride1) + (-2 * stride2)])+ 
		    L33*(block[base_idx + (3 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (0 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (3 * stride2)]+block_neg_neg[border_idx_3 + (2 * stride1) + (0 * stride2)])+
		    L34*(block[base_idx + (3 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (1 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (4 * stride2)]+block_neg_neg[border_idx_3 + (2 * stride1) + (1 * stride2)]+block[base_idx + (4 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (0 * stride2)]-block_neg_center[border_idx_1 + (3 * stride1) + (3 * stride2)]+block_neg_neg[border_idx_3 + (3 * stride1) + (0 * stride2)])+
		    L44*(block[base_idx + (4 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (1 * stride2)]-block_neg_center[border_idx_1 + (3 * stride1) + (4 * stride2)]+block_neg_neg[border_idx_3 + (3 * stride1) + (1 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(0, 3):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-2 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-1 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (3 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-1 * stride2)])+
		    L14*(block[base_idx + (1 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (0 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (4 * stride2)]+block_neg_neg[border_idx_3 + (0 * stride1) + (0 * stride2)]+block[base_idx + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (3 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (3 * stride1) + (-1 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-2 * stride2)])+
		    L23*(block[base_idx + (2 * stride1) + (3 * stride2)]-block[base_idx + (2 * stride1) + (-3 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (3 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (2 * stride2)]-block[base_idx + (3 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-2 * stride2)])+ 
		    L24*(block[base_idx + (2 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (0 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (4 * stride2)]+block_neg_neg[border_idx_3 + (1 * stride1) + (0 * stride2)]+block[base_idx + (4 * stride1) + (2 * stride2)]-block[base_idx + (4 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (3 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (3 * stride1) + (-2 * stride2)])+ 
		    L33*(block[base_idx + (3 * stride1) + (3 * stride2)]-block[base_idx + (3 * stride1) + (-3 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (3 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-3 * stride2)])+
		    L34*(block[base_idx + (3 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (0 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (4 * stride2)]+block_neg_neg[border_idx_3 + (2 * stride1) + (0 * stride2)]+block[base_idx + (4 * stride1) + (3 * stride2)]-block[base_idx + (4 * stride1) + (-3 * stride2)]-block_neg_center[border_idx_1 + (3 * stride1) + (3 * stride2)]+block_neg_center[border_idx_1 + (3 * stride1) + (-3 * stride2)])+
		    L44*(block[base_idx + (4 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (0 * stride2)]-block_neg_center[border_idx_1 + (3 * stride1) + (4 * stride2)]+block_neg_neg[border_idx_3 + (3 * stride1) + (0 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(1, 0):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (0 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (0 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (1 * stride2)]+block_neg_neg[border_idx_3 + (0 * stride1) + (0 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (2 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (2 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (0 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (1 * stride2)]+block_neg_neg[border_idx_3 + (1 * stride1) + (0 * stride2)])+
		    L14*(block[base_idx + (1 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (3 * stride2)]-block[base_idx + (-1 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (3 * stride2)]+block[base_idx + (4 * stride1) + (1 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (0 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (1 * stride2)]+block_neg_neg[border_idx_3 + (2 * stride1) + (0 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (1 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (2 * stride2)]+block_neg_neg[border_idx_3 + (0 * stride1) + (1 * stride2)])+
		    L23*(block[base_idx + (2 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (2 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (3 * stride2)]+block_neg_neg[border_idx_3 + (0 * stride1) + (2 * stride2)]+block[base_idx + (3 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (1 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (2 * stride2)]+block_neg_neg[border_idx_3 + (1 * stride1) + (1 * stride2)])+ 
		    L24*(block[base_idx + (2 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (3 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (4 * stride2)]+block_neg_neg[border_idx_3 + (0 * stride1) + (3 * stride2)]+block[base_idx + (4 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (1 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (2 * stride2)]+block_neg_neg[border_idx_3 + (2 * stride1) + (1 * stride2)])+ 
		    L33*(block[base_idx + (3 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (2 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (3 * stride2)]+block_neg_neg[border_idx_3 + (1 * stride1) + (2 * stride2)])+
		    L34*(block[base_idx + (3 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (3 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (4 * stride2)]+block_neg_neg[border_idx_3 + (1 * stride1) + (3 * stride2)]+block[base_idx + (4 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (2 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (3 * stride2)]+block_neg_neg[border_idx_3 + (2 * stride1) + (2 * stride2)])+
		    L44*(block[base_idx + (4 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (3 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (4 * stride2)]+block_neg_neg[border_idx_3 + (2 * stride1) + (3 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(1, 1):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-1 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-1 * stride2)])+
		    L14*(block[base_idx + (1 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (2 * stride2)]-block[base_idx + (-1 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (2 * stride2)]+block[base_idx + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-1 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (0 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (2 * stride2)]+block_neg_neg[border_idx_3 + (0 * stride1) + (0 * stride2)])+
		    L23*(block[base_idx + (2 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (1 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (3 * stride2)]+block_neg_neg[border_idx_3 + (0 * stride1) + (1 * stride2)]+block[base_idx + (3 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (0 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (2 * stride2)]+block_neg_neg[border_idx_3 + (1 * stride1) + (0 * stride2)])+ 
		    L24*(block[base_idx + (2 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (2 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (4 * stride2)]+block_neg_neg[border_idx_3 + (0 * stride1) + (2 * stride2)]+block[base_idx + (4 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (0 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (2 * stride2)]+block_neg_neg[border_idx_3 + (2 * stride1) + (0 * stride2)])+ 
		    L33*(block[base_idx + (3 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (1 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (3 * stride2)]+block_neg_neg[border_idx_3 + (1 * stride1) + (1 * stride2)])+
		    L34*(block[base_idx + (3 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (2 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (4 * stride2)]+block_neg_neg[border_idx_3 + (1 * stride1) + (2 * stride2)]+block[base_idx + (4 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (1 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (3 * stride2)]+block_neg_neg[border_idx_3 + (2 * stride1) + (1 * stride2)])+
		    L44*(block[base_idx + (4 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (2 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (4 * stride2)]+block_neg_neg[border_idx_3 + (2 * stride1) + (2 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(1, 2):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-1 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-1 * stride2)])+
		    L14*(block[base_idx + (1 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (-1 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block[base_idx + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-1 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-2 * stride2)])+
		    L23*(block[base_idx + (2 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (0 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (3 * stride2)]+block_neg_neg[border_idx_3 + (0 * stride1) + (0 * stride2)]+block[base_idx + (3 * stride1) + (2 * stride2)]-block[base_idx + (3 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-2 * stride2)])+ 
		    L24*(block[base_idx + (2 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (1 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (4 * stride2)]+block_neg_neg[border_idx_3 + (0 * stride1) + (1 * stride2)]+block[base_idx + (4 * stride1) + (2 * stride2)]-block[base_idx + (4 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-2 * stride2)])+ 
		    L33*(block[base_idx + (3 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (0 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (3 * stride2)]+block_neg_neg[border_idx_3 + (1 * stride1) + (0 * stride2)])+
		    L34*(block[base_idx + (3 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (1 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (4 * stride2)]+block_neg_neg[border_idx_3 + (1 * stride1) + (1 * stride2)]+block[base_idx + (4 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (0 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (3 * stride2)]+block_neg_neg[border_idx_3 + (2 * stride1) + (0 * stride2)])+
		    L44*(block[base_idx + (4 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (1 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (4 * stride2)]+block_neg_neg[border_idx_3 + (2 * stride1) + (1 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(1, 3):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-1 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-1 * stride2)])+
		    L14*(block[base_idx + (1 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (-1 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-1 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-2 * stride2)])+
		    L23*(block[base_idx + (2 * stride1) + (3 * stride2)]-block[base_idx + (2 * stride1) + (-3 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (3 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (2 * stride2)]-block[base_idx + (3 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-2 * stride2)])+ 
		    L24*(block[base_idx + (2 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (0 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (4 * stride2)]+block_neg_neg[border_idx_3 + (0 * stride1) + (0 * stride2)]+block[base_idx + (4 * stride1) + (2 * stride2)]-block[base_idx + (4 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-2 * stride2)])+ 
		    L33*(block[base_idx + (3 * stride1) + (3 * stride2)]-block[base_idx + (3 * stride1) + (-3 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (3 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-3 * stride2)])+
		    L34*(block[base_idx + (3 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (0 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (4 * stride2)]+block_neg_neg[border_idx_3 + (1 * stride1) + (0 * stride2)]+block[base_idx + (4 * stride1) + (3 * stride2)]-block[base_idx + (4 * stride1) + (-3 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (3 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-3 * stride2)])+
		    L44*(block[base_idx + (4 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (0 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (4 * stride2)]+block_neg_neg[border_idx_3 + (2 * stride1) + (0 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(2, 0):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (0 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (0 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (2 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (2 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (0 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (1 * stride2)]+block_neg_neg[border_idx_3 + (0 * stride1) + (0 * stride2)])+
		    L14*(block[base_idx + (1 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (3 * stride2)]-block[base_idx + (-1 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (3 * stride2)]+block[base_idx + (4 * stride1) + (1 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (0 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (1 * stride2)]+block_neg_neg[border_idx_3 + (1 * stride1) + (0 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (1 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (1 * stride2)])+
		    L23*(block[base_idx + (2 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (2 * stride2)]-block[base_idx + (-2 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (2 * stride2)]+block[base_idx + (3 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (1 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (2 * stride2)]+block_neg_neg[border_idx_3 + (0 * stride1) + (1 * stride2)])+ 
		    L24*(block[base_idx + (2 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (3 * stride2)]-block[base_idx + (-2 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (3 * stride2)]+block[base_idx + (4 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (1 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (2 * stride2)]+block_neg_neg[border_idx_3 + (1 * stride1) + (1 * stride2)])+ 
		    L33*(block[base_idx + (3 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (2 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (3 * stride2)]+block_neg_neg[border_idx_3 + (0 * stride1) + (2 * stride2)])+
		    L34*(block[base_idx + (3 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (3 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (4 * stride2)]+block_neg_neg[border_idx_3 + (0 * stride1) + (3 * stride2)]+block[base_idx + (4 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (2 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (3 * stride2)]+block_neg_neg[border_idx_3 + (1 * stride1) + (2 * stride2)])+
		    L44*(block[base_idx + (4 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (3 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (4 * stride2)]+block_neg_neg[border_idx_3 + (1 * stride1) + (3 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(2, 1):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-1 * stride2)])+
		    L14*(block[base_idx + (1 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (2 * stride2)]-block[base_idx + (-1 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (2 * stride2)]+block[base_idx + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-1 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (0 * stride2)])+
		    L23*(block[base_idx + (2 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (1 * stride2)]-block[base_idx + (-2 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (1 * stride2)]+block[base_idx + (3 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (0 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (2 * stride2)]+block_neg_neg[border_idx_3 + (0 * stride1) + (0 * stride2)])+ 
		    L24*(block[base_idx + (2 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (2 * stride2)]-block[base_idx + (-2 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (2 * stride2)]+block[base_idx + (4 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (0 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (2 * stride2)]+block_neg_neg[border_idx_3 + (1 * stride1) + (0 * stride2)])+ 
		    L33*(block[base_idx + (3 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (1 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (3 * stride2)]+block_neg_neg[border_idx_3 + (0 * stride1) + (1 * stride2)])+
		    L34*(block[base_idx + (3 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (2 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (4 * stride2)]+block_neg_neg[border_idx_3 + (0 * stride1) + (2 * stride2)]+block[base_idx + (4 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (1 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (3 * stride2)]+block_neg_neg[border_idx_3 + (1 * stride1) + (1 * stride2)])+
		    L44*(block[base_idx + (4 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (2 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (4 * stride2)]+block_neg_neg[border_idx_3 + (1 * stride1) + (2 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(2, 2):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-1 * stride2)])+
		    L14*(block[base_idx + (1 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (-1 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block[base_idx + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-1 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block[base_idx + (2 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (-2 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (0 * stride2)]+block[base_idx + (3 * stride1) + (2 * stride2)]-block[base_idx + (3 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-2 * stride2)])+ 
		    L24*(block[base_idx + (2 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (1 * stride2)]-block[base_idx + (-2 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (1 * stride2)]+block[base_idx + (4 * stride1) + (2 * stride2)]-block[base_idx + (4 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-2 * stride2)])+ 
		    L33*(block[base_idx + (3 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (0 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (3 * stride2)]+block_neg_neg[border_idx_3 + (0 * stride1) + (0 * stride2)])+
		    L34*(block[base_idx + (3 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (1 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (4 * stride2)]+block_neg_neg[border_idx_3 + (0 * stride1) + (1 * stride2)]+block[base_idx + (4 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (0 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (3 * stride2)]+block_neg_neg[border_idx_3 + (1 * stride1) + (0 * stride2)])+
		    L44*(block[base_idx + (4 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (1 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (4 * stride2)]+block_neg_neg[border_idx_3 + (1 * stride1) + (1 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(2, 3):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-1 * stride2)])+
		    L14*(block[base_idx + (1 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (-1 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-1 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block[base_idx + (2 * stride1) + (3 * stride2)]-block[base_idx + (2 * stride1) + (-3 * stride2)]-block[base_idx + (-2 * stride1) + (3 * stride2)]+block[base_idx + (-2 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (2 * stride2)]-block[base_idx + (3 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-2 * stride2)])+ 
		    L24*(block[base_idx + (2 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (-2 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (0 * stride2)]+block[base_idx + (4 * stride1) + (2 * stride2)]-block[base_idx + (4 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-2 * stride2)])+ 
		    L33*(block[base_idx + (3 * stride1) + (3 * stride2)]-block[base_idx + (3 * stride1) + (-3 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (3 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-3 * stride2)])+
		    L34*(block[base_idx + (3 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (0 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (4 * stride2)]+block_neg_neg[border_idx_3 + (0 * stride1) + (0 * stride2)]+block[base_idx + (4 * stride1) + (3 * stride2)]-block[base_idx + (4 * stride1) + (-3 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (3 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-3 * stride2)])+
		    L44*(block[base_idx + (4 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (0 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (4 * stride2)]+block_neg_neg[border_idx_3 + (1 * stride1) + (0 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(3, 0):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (0 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (0 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (2 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (2 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (0 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (0 * stride2)])+
		    L14*(block[base_idx + (1 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (3 * stride2)]-block[base_idx + (-1 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (3 * stride2)]+block[base_idx + (4 * stride1) + (1 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (0 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (1 * stride2)]+block_neg_neg[border_idx_3 + (0 * stride1) + (0 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (1 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (1 * stride2)])+
		    L23*(block[base_idx + (2 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (2 * stride2)]-block[base_idx + (-2 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (2 * stride2)]+block[base_idx + (3 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (1 * stride2)]-block[base_idx + (-3 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (1 * stride2)])+ 
		    L24*(block[base_idx + (2 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (3 * stride2)]-block[base_idx + (-2 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (3 * stride2)]+block[base_idx + (4 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (1 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (2 * stride2)]+block_neg_neg[border_idx_3 + (0 * stride1) + (1 * stride2)])+ 
		    L33*(block[base_idx + (3 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (2 * stride2)]-block[base_idx + (-3 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (2 * stride2)])+
		    L34*(block[base_idx + (3 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (3 * stride2)]-block[base_idx + (-3 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (3 * stride2)]+block[base_idx + (4 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (2 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (3 * stride2)]+block_neg_neg[border_idx_3 + (0 * stride1) + (2 * stride2)])+
		    L44*(block[base_idx + (4 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (3 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (4 * stride2)]+block_neg_neg[border_idx_3 + (0 * stride1) + (3 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(3, 1):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block[base_idx + (1 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (2 * stride2)]-block[base_idx + (-1 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (2 * stride2)]+block[base_idx + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-1 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (0 * stride2)])+
		    L23*(block[base_idx + (2 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (1 * stride2)]-block[base_idx + (-2 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (1 * stride2)]+block[base_idx + (3 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (0 * stride2)]-block[base_idx + (-3 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (0 * stride2)])+ 
		    L24*(block[base_idx + (2 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (2 * stride2)]-block[base_idx + (-2 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (2 * stride2)]+block[base_idx + (4 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (0 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (2 * stride2)]+block_neg_neg[border_idx_3 + (0 * stride1) + (0 * stride2)])+ 
		    L33*(block[base_idx + (3 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (1 * stride2)]-block[base_idx + (-3 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (1 * stride2)])+
		    L34*(block[base_idx + (3 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (2 * stride2)]-block[base_idx + (-3 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (2 * stride2)]+block[base_idx + (4 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (1 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (3 * stride2)]+block_neg_neg[border_idx_3 + (0 * stride1) + (1 * stride2)])+
		    L44*(block[base_idx + (4 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (2 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (4 * stride2)]+block_neg_neg[border_idx_3 + (0 * stride1) + (2 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(3, 2):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block[base_idx + (1 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (-1 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block[base_idx + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-1 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block[base_idx + (2 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (-2 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (0 * stride2)]+block[base_idx + (3 * stride1) + (2 * stride2)]-block[base_idx + (3 * stride1) + (-2 * stride2)]-block[base_idx + (-3 * stride1) + (2 * stride2)]+block[base_idx + (-3 * stride1) + (-2 * stride2)])+ 
		    L24*(block[base_idx + (2 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (1 * stride2)]-block[base_idx + (-2 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (1 * stride2)]+block[base_idx + (4 * stride1) + (2 * stride2)]-block[base_idx + (4 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-2 * stride2)])+ 
		    L33*(block[base_idx + (3 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (0 * stride2)]-block[base_idx + (-3 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (0 * stride2)])+
		    L34*(block[base_idx + (3 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (1 * stride2)]-block[base_idx + (-3 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (1 * stride2)]+block[base_idx + (4 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (0 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (3 * stride2)]+block_neg_neg[border_idx_3 + (0 * stride1) + (0 * stride2)])+
		    L44*(block[base_idx + (4 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (1 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (4 * stride2)]+block_neg_neg[border_idx_3 + (0 * stride1) + (1 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(3, 3):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block[base_idx + (1 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (-1 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-1 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block[base_idx + (2 * stride1) + (3 * stride2)]-block[base_idx + (2 * stride1) + (-3 * stride2)]-block[base_idx + (-2 * stride1) + (3 * stride2)]+block[base_idx + (-2 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (2 * stride2)]-block[base_idx + (3 * stride1) + (-2 * stride2)]-block[base_idx + (-3 * stride1) + (2 * stride2)]+block[base_idx + (-3 * stride1) + (-2 * stride2)])+ 
		    L24*(block[base_idx + (2 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (-2 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (0 * stride2)]+block[base_idx + (4 * stride1) + (2 * stride2)]-block[base_idx + (4 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-2 * stride2)])+ 
		    L33*(block[base_idx + (3 * stride1) + (3 * stride2)]-block[base_idx + (3 * stride1) + (-3 * stride2)]-block[base_idx + (-3 * stride1) + (3 * stride2)]+block[base_idx + (-3 * stride1) + (-3 * stride2)])+
		    L34*(block[base_idx + (3 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (0 * stride2)]-block[base_idx + (-3 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (0 * stride2)]+block[base_idx + (4 * stride1) + (3 * stride2)]-block[base_idx + (4 * stride1) + (-3 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (3 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-3 * stride2)])+
		    L44*(block[base_idx + (4 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (0 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (4 * stride2)]+block_neg_neg[border_idx_3 + (0 * stride1) + (0 * stride2)]))*(dinv)
		);
	default: UNREACHABLE; 
	}
}

FP cross_deriv_neg_pos(
    const FP* block, const size_t base_idx,
    const size_t dir1, const FP* block_neg_center, const FP* block_pos_center, const int stride1,
    const size_t dir2, const FP* block_center_neg, const FP* block_center_pos, const int stride2,
    const FP* block_pos_pos, const FP* block_pos_neg, 
    const FP* block_neg_pos, const FP* block_neg_neg,
    const int cube_width, const FP dinv
){	
	const int depth1 = dir1;
	const size_t border_idx_1 = flip(0, base_idx - depth1 * stride1, stride1, cube_width);
	
	const int depth2 = cube_width - 1 - dir2;
	const size_t border_idx_2 = flip(cube_width - 1, base_idx + depth2 * stride2, stride2, cube_width);
	
	const size_t border_idx_3 = flip(cube_width - 1, border_idx_1 + depth2 * stride2, stride2, cube_width);
    switch (BITMASK_PAIR(depth1, depth2)){
    case BITMASK_PAIR(0, 0):
		return (
		    (L11*(block_center_pos[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block_neg_pos[border_idx_3 + (0 * stride1) + (0 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-1 * stride2)])+
		    L12*(block_center_pos[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block_neg_pos[border_idx_3 + (0 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-2 * stride2)]+block_center_pos[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block_neg_pos[border_idx_3 + (1 * stride1) + (0 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-1 * stride2)])+
		    L13*(block_center_pos[border_idx_2 + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block_neg_pos[border_idx_3 + (0 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-3 * stride2)]+block_center_pos[border_idx_2 + (3 * stride1) + (0 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block_neg_pos[border_idx_3 + (2 * stride1) + (0 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-1 * stride2)])+
		    L14*(block_center_pos[border_idx_2 + (1 * stride1) + (3 * stride2)]-block[base_idx + (1 * stride1) + (-4 * stride2)]-block_neg_pos[border_idx_3 + (0 * stride1) + (3 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-4 * stride2)]+block_center_pos[border_idx_2 + (4 * stride1) + (0 * stride2)]-block[base_idx + (4 * stride1) + (-1 * stride2)]-block_neg_pos[border_idx_3 + (3 * stride1) + (0 * stride2)]+block_neg_center[border_idx_1 + (3 * stride1) + (-1 * stride2)])+
		    L22*(block_center_pos[border_idx_2 + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block_neg_pos[border_idx_3 + (1 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-2 * stride2)])+
		    L23*(block_center_pos[border_idx_2 + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-3 * stride2)]-block_neg_pos[border_idx_3 + (1 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-3 * stride2)]+block_center_pos[border_idx_2 + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-2 * stride2)]-block_neg_pos[border_idx_3 + (2 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-2 * stride2)])+ 
		    L24*(block_center_pos[border_idx_2 + (2 * stride1) + (3 * stride2)]-block[base_idx + (2 * stride1) + (-4 * stride2)]-block_neg_pos[border_idx_3 + (1 * stride1) + (3 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-4 * stride2)]+block_center_pos[border_idx_2 + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-2 * stride2)]-block_neg_pos[border_idx_3 + (3 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (3 * stride1) + (-2 * stride2)])+ 
		    L33*(block_center_pos[border_idx_2 + (3 * stride1) + (2 * stride2)]-block[base_idx + (3 * stride1) + (-3 * stride2)]-block_neg_pos[border_idx_3 + (2 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-3 * stride2)])+
		    L34*(block_center_pos[border_idx_2 + (3 * stride1) + (3 * stride2)]-block[base_idx + (3 * stride1) + (-4 * stride2)]-block_neg_pos[border_idx_3 + (2 * stride1) + (3 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-4 * stride2)]+block_center_pos[border_idx_2 + (4 * stride1) + (2 * stride2)]-block[base_idx + (4 * stride1) + (-3 * stride2)]-block_neg_pos[border_idx_3 + (3 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (3 * stride1) + (-3 * stride2)])+
		    L44*(block_center_pos[border_idx_2 + (4 * stride1) + (3 * stride2)]-block[base_idx + (4 * stride1) + (-4 * stride2)]-block_neg_pos[border_idx_3 + (3 * stride1) + (3 * stride2)]+block_neg_center[border_idx_1 + (3 * stride1) + (-4 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(0, 1):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-1 * stride2)])+
		    L12*(block_center_pos[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block_neg_pos[border_idx_3 + (0 * stride1) + (0 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-2 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-1 * stride2)])+
		    L13*(block_center_pos[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block_neg_pos[border_idx_3 + (0 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-1 * stride2)])+
		    L14*(block_center_pos[border_idx_2 + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-4 * stride2)]-block_neg_pos[border_idx_3 + (0 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (3 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (3 * stride1) + (-1 * stride2)])+
		    L22*(block_center_pos[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block_neg_pos[border_idx_3 + (1 * stride1) + (0 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-2 * stride2)])+
		    L23*(block_center_pos[border_idx_2 + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-3 * stride2)]-block_neg_pos[border_idx_3 + (1 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-3 * stride2)]+block_center_pos[border_idx_2 + (3 * stride1) + (0 * stride2)]-block[base_idx + (3 * stride1) + (-2 * stride2)]-block_neg_pos[border_idx_3 + (2 * stride1) + (0 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-2 * stride2)])+ 
		    L24*(block_center_pos[border_idx_2 + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-4 * stride2)]-block_neg_pos[border_idx_3 + (1 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-4 * stride2)]+block_center_pos[border_idx_2 + (4 * stride1) + (0 * stride2)]-block[base_idx + (4 * stride1) + (-2 * stride2)]-block_neg_pos[border_idx_3 + (3 * stride1) + (0 * stride2)]+block_neg_center[border_idx_1 + (3 * stride1) + (-2 * stride2)])+ 
		    L33*(block_center_pos[border_idx_2 + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-3 * stride2)]-block_neg_pos[border_idx_3 + (2 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-3 * stride2)])+
		    L34*(block_center_pos[border_idx_2 + (3 * stride1) + (2 * stride2)]-block[base_idx + (3 * stride1) + (-4 * stride2)]-block_neg_pos[border_idx_3 + (2 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-4 * stride2)]+block_center_pos[border_idx_2 + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-3 * stride2)]-block_neg_pos[border_idx_3 + (3 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (3 * stride1) + (-3 * stride2)])+
		    L44*(block_center_pos[border_idx_2 + (4 * stride1) + (2 * stride2)]-block[base_idx + (4 * stride1) + (-4 * stride2)]-block_neg_pos[border_idx_3 + (3 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (3 * stride1) + (-4 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(0, 2):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-2 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-1 * stride2)])+
		    L13*(block_center_pos[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block_neg_pos[border_idx_3 + (0 * stride1) + (0 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-1 * stride2)])+
		    L14*(block_center_pos[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-4 * stride2)]-block_neg_pos[border_idx_3 + (0 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (3 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (3 * stride1) + (-1 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-2 * stride2)])+
		    L23*(block_center_pos[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (2 * stride1) + (-3 * stride2)]-block_neg_pos[border_idx_3 + (1 * stride1) + (0 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (2 * stride2)]-block[base_idx + (3 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-2 * stride2)])+ 
		    L24*(block_center_pos[border_idx_2 + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-4 * stride2)]-block_neg_pos[border_idx_3 + (1 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (2 * stride2)]-block[base_idx + (4 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (3 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (3 * stride1) + (-2 * stride2)])+ 
		    L33*(block_center_pos[border_idx_2 + (3 * stride1) + (0 * stride2)]-block[base_idx + (3 * stride1) + (-3 * stride2)]-block_neg_pos[border_idx_3 + (2 * stride1) + (0 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-3 * stride2)])+
		    L34*(block_center_pos[border_idx_2 + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-4 * stride2)]-block_neg_pos[border_idx_3 + (2 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-4 * stride2)]+block_center_pos[border_idx_2 + (4 * stride1) + (0 * stride2)]-block[base_idx + (4 * stride1) + (-3 * stride2)]-block_neg_pos[border_idx_3 + (3 * stride1) + (0 * stride2)]+block_neg_center[border_idx_1 + (3 * stride1) + (-3 * stride2)])+
		    L44*(block_center_pos[border_idx_2 + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-4 * stride2)]-block_neg_pos[border_idx_3 + (3 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (3 * stride1) + (-4 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(0, 3):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-2 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-1 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (3 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-1 * stride2)])+
		    L14*(block_center_pos[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (1 * stride1) + (-4 * stride2)]-block_neg_pos[border_idx_3 + (0 * stride1) + (0 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (3 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (3 * stride1) + (-1 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-2 * stride2)])+
		    L23*(block[base_idx + (2 * stride1) + (3 * stride2)]-block[base_idx + (2 * stride1) + (-3 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (3 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (2 * stride2)]-block[base_idx + (3 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-2 * stride2)])+ 
		    L24*(block_center_pos[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (2 * stride1) + (-4 * stride2)]-block_neg_pos[border_idx_3 + (1 * stride1) + (0 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (2 * stride2)]-block[base_idx + (4 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (3 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (3 * stride1) + (-2 * stride2)])+ 
		    L33*(block[base_idx + (3 * stride1) + (3 * stride2)]-block[base_idx + (3 * stride1) + (-3 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (3 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-3 * stride2)])+
		    L34*(block_center_pos[border_idx_2 + (3 * stride1) + (0 * stride2)]-block[base_idx + (3 * stride1) + (-4 * stride2)]-block_neg_pos[border_idx_3 + (2 * stride1) + (0 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (3 * stride2)]-block[base_idx + (4 * stride1) + (-3 * stride2)]-block_neg_center[border_idx_1 + (3 * stride1) + (3 * stride2)]+block_neg_center[border_idx_1 + (3 * stride1) + (-3 * stride2)])+
		    L44*(block_center_pos[border_idx_2 + (4 * stride1) + (0 * stride2)]-block[base_idx + (4 * stride1) + (-4 * stride2)]-block_neg_pos[border_idx_3 + (3 * stride1) + (0 * stride2)]+block_neg_center[border_idx_1 + (3 * stride1) + (-4 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(1, 0):
		return (
		    (L11*(block_center_pos[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block_center_pos[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block_center_pos[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block_neg_pos[border_idx_3 + (0 * stride1) + (0 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-1 * stride2)])+
		    L13*(block_center_pos[border_idx_2 + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block_center_pos[border_idx_2 + (3 * stride1) + (0 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block_neg_pos[border_idx_3 + (1 * stride1) + (0 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-1 * stride2)])+
		    L14*(block_center_pos[border_idx_2 + (1 * stride1) + (3 * stride2)]-block[base_idx + (1 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (3 * stride2)]+block[base_idx + (-1 * stride1) + (-4 * stride2)]+block_center_pos[border_idx_2 + (4 * stride1) + (0 * stride2)]-block[base_idx + (4 * stride1) + (-1 * stride2)]-block_neg_pos[border_idx_3 + (2 * stride1) + (0 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-1 * stride2)])+
		    L22*(block_center_pos[border_idx_2 + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block_neg_pos[border_idx_3 + (0 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-2 * stride2)])+
		    L23*(block_center_pos[border_idx_2 + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-3 * stride2)]-block_neg_pos[border_idx_3 + (0 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-3 * stride2)]+block_center_pos[border_idx_2 + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-2 * stride2)]-block_neg_pos[border_idx_3 + (1 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-2 * stride2)])+ 
		    L24*(block_center_pos[border_idx_2 + (2 * stride1) + (3 * stride2)]-block[base_idx + (2 * stride1) + (-4 * stride2)]-block_neg_pos[border_idx_3 + (0 * stride1) + (3 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-4 * stride2)]+block_center_pos[border_idx_2 + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-2 * stride2)]-block_neg_pos[border_idx_3 + (2 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-2 * stride2)])+ 
		    L33*(block_center_pos[border_idx_2 + (3 * stride1) + (2 * stride2)]-block[base_idx + (3 * stride1) + (-3 * stride2)]-block_neg_pos[border_idx_3 + (1 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-3 * stride2)])+
		    L34*(block_center_pos[border_idx_2 + (3 * stride1) + (3 * stride2)]-block[base_idx + (3 * stride1) + (-4 * stride2)]-block_neg_pos[border_idx_3 + (1 * stride1) + (3 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-4 * stride2)]+block_center_pos[border_idx_2 + (4 * stride1) + (2 * stride2)]-block[base_idx + (4 * stride1) + (-3 * stride2)]-block_neg_pos[border_idx_3 + (2 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-3 * stride2)])+
		    L44*(block_center_pos[border_idx_2 + (4 * stride1) + (3 * stride2)]-block[base_idx + (4 * stride1) + (-4 * stride2)]-block_neg_pos[border_idx_3 + (2 * stride1) + (3 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-4 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(1, 1):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block_center_pos[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-1 * stride2)])+
		    L13*(block_center_pos[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-1 * stride2)])+
		    L14*(block_center_pos[border_idx_2 + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-1 * stride2)])+
		    L22*(block_center_pos[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block_neg_pos[border_idx_3 + (0 * stride1) + (0 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-2 * stride2)])+
		    L23*(block_center_pos[border_idx_2 + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-3 * stride2)]-block_neg_pos[border_idx_3 + (0 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-3 * stride2)]+block_center_pos[border_idx_2 + (3 * stride1) + (0 * stride2)]-block[base_idx + (3 * stride1) + (-2 * stride2)]-block_neg_pos[border_idx_3 + (1 * stride1) + (0 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-2 * stride2)])+ 
		    L24*(block_center_pos[border_idx_2 + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-4 * stride2)]-block_neg_pos[border_idx_3 + (0 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-4 * stride2)]+block_center_pos[border_idx_2 + (4 * stride1) + (0 * stride2)]-block[base_idx + (4 * stride1) + (-2 * stride2)]-block_neg_pos[border_idx_3 + (2 * stride1) + (0 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-2 * stride2)])+ 
		    L33*(block_center_pos[border_idx_2 + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-3 * stride2)]-block_neg_pos[border_idx_3 + (1 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-3 * stride2)])+
		    L34*(block_center_pos[border_idx_2 + (3 * stride1) + (2 * stride2)]-block[base_idx + (3 * stride1) + (-4 * stride2)]-block_neg_pos[border_idx_3 + (1 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-4 * stride2)]+block_center_pos[border_idx_2 + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-3 * stride2)]-block_neg_pos[border_idx_3 + (2 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-3 * stride2)])+
		    L44*(block_center_pos[border_idx_2 + (4 * stride1) + (2 * stride2)]-block[base_idx + (4 * stride1) + (-4 * stride2)]-block_neg_pos[border_idx_3 + (2 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-4 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(1, 2):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-1 * stride2)])+
		    L13*(block_center_pos[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-1 * stride2)])+
		    L14*(block_center_pos[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-1 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-2 * stride2)])+
		    L23*(block_center_pos[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (2 * stride1) + (-3 * stride2)]-block_neg_pos[border_idx_3 + (0 * stride1) + (0 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (2 * stride2)]-block[base_idx + (3 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-2 * stride2)])+ 
		    L24*(block_center_pos[border_idx_2 + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-4 * stride2)]-block_neg_pos[border_idx_3 + (0 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (2 * stride2)]-block[base_idx + (4 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-2 * stride2)])+ 
		    L33*(block_center_pos[border_idx_2 + (3 * stride1) + (0 * stride2)]-block[base_idx + (3 * stride1) + (-3 * stride2)]-block_neg_pos[border_idx_3 + (1 * stride1) + (0 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-3 * stride2)])+
		    L34*(block_center_pos[border_idx_2 + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-4 * stride2)]-block_neg_pos[border_idx_3 + (1 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-4 * stride2)]+block_center_pos[border_idx_2 + (4 * stride1) + (0 * stride2)]-block[base_idx + (4 * stride1) + (-3 * stride2)]-block_neg_pos[border_idx_3 + (2 * stride1) + (0 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-3 * stride2)])+
		    L44*(block_center_pos[border_idx_2 + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-4 * stride2)]-block_neg_pos[border_idx_3 + (2 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-4 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(1, 3):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-1 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-1 * stride2)])+
		    L14*(block_center_pos[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (1 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (-1 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-1 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-2 * stride2)])+
		    L23*(block[base_idx + (2 * stride1) + (3 * stride2)]-block[base_idx + (2 * stride1) + (-3 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (3 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (2 * stride2)]-block[base_idx + (3 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-2 * stride2)])+ 
		    L24*(block_center_pos[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (2 * stride1) + (-4 * stride2)]-block_neg_pos[border_idx_3 + (0 * stride1) + (0 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (2 * stride2)]-block[base_idx + (4 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-2 * stride2)])+ 
		    L33*(block[base_idx + (3 * stride1) + (3 * stride2)]-block[base_idx + (3 * stride1) + (-3 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (3 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-3 * stride2)])+
		    L34*(block_center_pos[border_idx_2 + (3 * stride1) + (0 * stride2)]-block[base_idx + (3 * stride1) + (-4 * stride2)]-block_neg_pos[border_idx_3 + (1 * stride1) + (0 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (3 * stride2)]-block[base_idx + (4 * stride1) + (-3 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (3 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-3 * stride2)])+
		    L44*(block_center_pos[border_idx_2 + (4 * stride1) + (0 * stride2)]-block[base_idx + (4 * stride1) + (-4 * stride2)]-block_neg_pos[border_idx_3 + (2 * stride1) + (0 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-4 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(2, 0):
		return (
		    (L11*(block_center_pos[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block_center_pos[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block_center_pos[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (0 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block_center_pos[border_idx_2 + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block_center_pos[border_idx_2 + (3 * stride1) + (0 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block_neg_pos[border_idx_3 + (0 * stride1) + (0 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-1 * stride2)])+
		    L14*(block_center_pos[border_idx_2 + (1 * stride1) + (3 * stride2)]-block[base_idx + (1 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (3 * stride2)]+block[base_idx + (-1 * stride1) + (-4 * stride2)]+block_center_pos[border_idx_2 + (4 * stride1) + (0 * stride2)]-block[base_idx + (4 * stride1) + (-1 * stride2)]-block_neg_pos[border_idx_3 + (1 * stride1) + (0 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-1 * stride2)])+
		    L22*(block_center_pos[border_idx_2 + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block_center_pos[border_idx_2 + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-3 * stride2)]+block_center_pos[border_idx_2 + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-2 * stride2)]-block_neg_pos[border_idx_3 + (0 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-2 * stride2)])+ 
		    L24*(block_center_pos[border_idx_2 + (2 * stride1) + (3 * stride2)]-block[base_idx + (2 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (3 * stride2)]+block[base_idx + (-2 * stride1) + (-4 * stride2)]+block_center_pos[border_idx_2 + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-2 * stride2)]-block_neg_pos[border_idx_3 + (1 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-2 * stride2)])+ 
		    L33*(block_center_pos[border_idx_2 + (3 * stride1) + (2 * stride2)]-block[base_idx + (3 * stride1) + (-3 * stride2)]-block_neg_pos[border_idx_3 + (0 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-3 * stride2)])+
		    L34*(block_center_pos[border_idx_2 + (3 * stride1) + (3 * stride2)]-block[base_idx + (3 * stride1) + (-4 * stride2)]-block_neg_pos[border_idx_3 + (0 * stride1) + (3 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-4 * stride2)]+block_center_pos[border_idx_2 + (4 * stride1) + (2 * stride2)]-block[base_idx + (4 * stride1) + (-3 * stride2)]-block_neg_pos[border_idx_3 + (1 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-3 * stride2)])+
		    L44*(block_center_pos[border_idx_2 + (4 * stride1) + (3 * stride2)]-block[base_idx + (4 * stride1) + (-4 * stride2)]-block_neg_pos[border_idx_3 + (1 * stride1) + (3 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-4 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(2, 1):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block_center_pos[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block_center_pos[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-1 * stride2)])+
		    L14*(block_center_pos[border_idx_2 + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-1 * stride2)])+
		    L22*(block_center_pos[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (0 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block_center_pos[border_idx_2 + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-3 * stride2)]+block_center_pos[border_idx_2 + (3 * stride1) + (0 * stride2)]-block[base_idx + (3 * stride1) + (-2 * stride2)]-block_neg_pos[border_idx_3 + (0 * stride1) + (0 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-2 * stride2)])+ 
		    L24*(block_center_pos[border_idx_2 + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-4 * stride2)]+block_center_pos[border_idx_2 + (4 * stride1) + (0 * stride2)]-block[base_idx + (4 * stride1) + (-2 * stride2)]-block_neg_pos[border_idx_3 + (1 * stride1) + (0 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-2 * stride2)])+ 
		    L33*(block_center_pos[border_idx_2 + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-3 * stride2)]-block_neg_pos[border_idx_3 + (0 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-3 * stride2)])+
		    L34*(block_center_pos[border_idx_2 + (3 * stride1) + (2 * stride2)]-block[base_idx + (3 * stride1) + (-4 * stride2)]-block_neg_pos[border_idx_3 + (0 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-4 * stride2)]+block_center_pos[border_idx_2 + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-3 * stride2)]-block_neg_pos[border_idx_3 + (1 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-3 * stride2)])+
		    L44*(block_center_pos[border_idx_2 + (4 * stride1) + (2 * stride2)]-block[base_idx + (4 * stride1) + (-4 * stride2)]-block_neg_pos[border_idx_3 + (1 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-4 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(2, 2):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block_center_pos[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-1 * stride2)])+
		    L14*(block_center_pos[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-1 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block_center_pos[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (2 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (0 * stride2)]+block[base_idx + (-2 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (2 * stride2)]-block[base_idx + (3 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-2 * stride2)])+ 
		    L24*(block_center_pos[border_idx_2 + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (2 * stride2)]-block[base_idx + (4 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-2 * stride2)])+ 
		    L33*(block_center_pos[border_idx_2 + (3 * stride1) + (0 * stride2)]-block[base_idx + (3 * stride1) + (-3 * stride2)]-block_neg_pos[border_idx_3 + (0 * stride1) + (0 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-3 * stride2)])+
		    L34*(block_center_pos[border_idx_2 + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-4 * stride2)]-block_neg_pos[border_idx_3 + (0 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-4 * stride2)]+block_center_pos[border_idx_2 + (4 * stride1) + (0 * stride2)]-block[base_idx + (4 * stride1) + (-3 * stride2)]-block_neg_pos[border_idx_3 + (1 * stride1) + (0 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-3 * stride2)])+
		    L44*(block_center_pos[border_idx_2 + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-4 * stride2)]-block_neg_pos[border_idx_3 + (1 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-4 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(2, 3):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-1 * stride2)])+
		    L14*(block_center_pos[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (1 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (-1 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-1 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block[base_idx + (2 * stride1) + (3 * stride2)]-block[base_idx + (2 * stride1) + (-3 * stride2)]-block[base_idx + (-2 * stride1) + (3 * stride2)]+block[base_idx + (-2 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (2 * stride2)]-block[base_idx + (3 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-2 * stride2)])+ 
		    L24*(block_center_pos[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (2 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (0 * stride2)]+block[base_idx + (-2 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (2 * stride2)]-block[base_idx + (4 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-2 * stride2)])+ 
		    L33*(block[base_idx + (3 * stride1) + (3 * stride2)]-block[base_idx + (3 * stride1) + (-3 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (3 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-3 * stride2)])+
		    L34*(block_center_pos[border_idx_2 + (3 * stride1) + (0 * stride2)]-block[base_idx + (3 * stride1) + (-4 * stride2)]-block_neg_pos[border_idx_3 + (0 * stride1) + (0 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (3 * stride2)]-block[base_idx + (4 * stride1) + (-3 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (3 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-3 * stride2)])+
		    L44*(block_center_pos[border_idx_2 + (4 * stride1) + (0 * stride2)]-block[base_idx + (4 * stride1) + (-4 * stride2)]-block_neg_pos[border_idx_3 + (1 * stride1) + (0 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-4 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(3, 0):
		return (
		    (L11*(block_center_pos[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block_center_pos[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block_center_pos[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (0 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block_center_pos[border_idx_2 + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block_center_pos[border_idx_2 + (3 * stride1) + (0 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (0 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block_center_pos[border_idx_2 + (1 * stride1) + (3 * stride2)]-block[base_idx + (1 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (3 * stride2)]+block[base_idx + (-1 * stride1) + (-4 * stride2)]+block_center_pos[border_idx_2 + (4 * stride1) + (0 * stride2)]-block[base_idx + (4 * stride1) + (-1 * stride2)]-block_neg_pos[border_idx_3 + (0 * stride1) + (0 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-1 * stride2)])+
		    L22*(block_center_pos[border_idx_2 + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block_center_pos[border_idx_2 + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-3 * stride2)]+block_center_pos[border_idx_2 + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-2 * stride2)])+ 
		    L24*(block_center_pos[border_idx_2 + (2 * stride1) + (3 * stride2)]-block[base_idx + (2 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (3 * stride2)]+block[base_idx + (-2 * stride1) + (-4 * stride2)]+block_center_pos[border_idx_2 + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-2 * stride2)]-block_neg_pos[border_idx_3 + (0 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-2 * stride2)])+ 
		    L33*(block_center_pos[border_idx_2 + (3 * stride1) + (2 * stride2)]-block[base_idx + (3 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (2 * stride2)]+block[base_idx + (-3 * stride1) + (-3 * stride2)])+
		    L34*(block_center_pos[border_idx_2 + (3 * stride1) + (3 * stride2)]-block[base_idx + (3 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (3 * stride2)]+block[base_idx + (-3 * stride1) + (-4 * stride2)]+block_center_pos[border_idx_2 + (4 * stride1) + (2 * stride2)]-block[base_idx + (4 * stride1) + (-3 * stride2)]-block_neg_pos[border_idx_3 + (0 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-3 * stride2)])+
		    L44*(block_center_pos[border_idx_2 + (4 * stride1) + (3 * stride2)]-block[base_idx + (4 * stride1) + (-4 * stride2)]-block_neg_pos[border_idx_3 + (0 * stride1) + (3 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-4 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(3, 1):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block_center_pos[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block_center_pos[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block_center_pos[border_idx_2 + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-1 * stride2)])+
		    L22*(block_center_pos[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (0 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block_center_pos[border_idx_2 + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-3 * stride2)]+block_center_pos[border_idx_2 + (3 * stride1) + (0 * stride2)]-block[base_idx + (3 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (0 * stride2)]+block[base_idx + (-3 * stride1) + (-2 * stride2)])+ 
		    L24*(block_center_pos[border_idx_2 + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-4 * stride2)]+block_center_pos[border_idx_2 + (4 * stride1) + (0 * stride2)]-block[base_idx + (4 * stride1) + (-2 * stride2)]-block_neg_pos[border_idx_3 + (0 * stride1) + (0 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-2 * stride2)])+ 
		    L33*(block_center_pos[border_idx_2 + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-3 * stride2)])+
		    L34*(block_center_pos[border_idx_2 + (3 * stride1) + (2 * stride2)]-block[base_idx + (3 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (2 * stride2)]+block[base_idx + (-3 * stride1) + (-4 * stride2)]+block_center_pos[border_idx_2 + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-3 * stride2)]-block_neg_pos[border_idx_3 + (0 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-3 * stride2)])+
		    L44*(block_center_pos[border_idx_2 + (4 * stride1) + (2 * stride2)]-block[base_idx + (4 * stride1) + (-4 * stride2)]-block_neg_pos[border_idx_3 + (0 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-4 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(3, 2):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block_center_pos[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block_center_pos[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-1 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block_center_pos[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (2 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (0 * stride2)]+block[base_idx + (-2 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (2 * stride2)]-block[base_idx + (3 * stride1) + (-2 * stride2)]-block[base_idx + (-3 * stride1) + (2 * stride2)]+block[base_idx + (-3 * stride1) + (-2 * stride2)])+ 
		    L24*(block_center_pos[border_idx_2 + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (2 * stride2)]-block[base_idx + (4 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-2 * stride2)])+ 
		    L33*(block_center_pos[border_idx_2 + (3 * stride1) + (0 * stride2)]-block[base_idx + (3 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (0 * stride2)]+block[base_idx + (-3 * stride1) + (-3 * stride2)])+
		    L34*(block_center_pos[border_idx_2 + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-4 * stride2)]+block_center_pos[border_idx_2 + (4 * stride1) + (0 * stride2)]-block[base_idx + (4 * stride1) + (-3 * stride2)]-block_neg_pos[border_idx_3 + (0 * stride1) + (0 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-3 * stride2)])+
		    L44*(block_center_pos[border_idx_2 + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-4 * stride2)]-block_neg_pos[border_idx_3 + (0 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-4 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(3, 3):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block_center_pos[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (1 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (-1 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-1 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block[base_idx + (2 * stride1) + (3 * stride2)]-block[base_idx + (2 * stride1) + (-3 * stride2)]-block[base_idx + (-2 * stride1) + (3 * stride2)]+block[base_idx + (-2 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (2 * stride2)]-block[base_idx + (3 * stride1) + (-2 * stride2)]-block[base_idx + (-3 * stride1) + (2 * stride2)]+block[base_idx + (-3 * stride1) + (-2 * stride2)])+ 
		    L24*(block_center_pos[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (2 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (0 * stride2)]+block[base_idx + (-2 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (2 * stride2)]-block[base_idx + (4 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-2 * stride2)])+ 
		    L33*(block[base_idx + (3 * stride1) + (3 * stride2)]-block[base_idx + (3 * stride1) + (-3 * stride2)]-block[base_idx + (-3 * stride1) + (3 * stride2)]+block[base_idx + (-3 * stride1) + (-3 * stride2)])+
		    L34*(block_center_pos[border_idx_2 + (3 * stride1) + (0 * stride2)]-block[base_idx + (3 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (0 * stride2)]+block[base_idx + (-3 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (3 * stride2)]-block[base_idx + (4 * stride1) + (-3 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (3 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-3 * stride2)])+
		    L44*(block_center_pos[border_idx_2 + (4 * stride1) + (0 * stride2)]-block[base_idx + (4 * stride1) + (-4 * stride2)]-block_neg_pos[border_idx_3 + (0 * stride1) + (0 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-4 * stride2)]))*(dinv)
		);
	default: UNREACHABLE; 
	}
}

FP cross_deriv_neg_center(
    const FP* block, const size_t base_idx,
    const size_t dir1, const FP* block_neg_center, const FP* block_pos_center, const int stride1,
    const size_t dir2, const FP* block_center_neg, const FP* block_center_pos, const int stride2,
    const FP* block_pos_pos, const FP* block_pos_neg, 
    const FP* block_neg_pos, const FP* block_neg_neg,
    const int cube_width, const FP dinv
){	
	const int depth1 = dir1;
	const size_t border_idx_1 = flip(0, base_idx - depth1 * stride1, stride1, cube_width);
    switch (depth1){
    case 0:
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-2 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-1 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (3 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-1 * stride2)])+
		    L14*(block[base_idx + (1 * stride1) + (4 * stride2)]-block[base_idx + (1 * stride1) + (-4 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (4 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (3 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (3 * stride1) + (-1 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-2 * stride2)])+
		    L23*(block[base_idx + (2 * stride1) + (3 * stride2)]-block[base_idx + (2 * stride1) + (-3 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (3 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (2 * stride2)]-block[base_idx + (3 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-2 * stride2)])+ 
		    L24*(block[base_idx + (2 * stride1) + (4 * stride2)]-block[base_idx + (2 * stride1) + (-4 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (4 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (2 * stride2)]-block[base_idx + (4 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (3 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (3 * stride1) + (-2 * stride2)])+ 
		    L33*(block[base_idx + (3 * stride1) + (3 * stride2)]-block[base_idx + (3 * stride1) + (-3 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (3 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-3 * stride2)])+
		    L34*(block[base_idx + (3 * stride1) + (4 * stride2)]-block[base_idx + (3 * stride1) + (-4 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (4 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (3 * stride2)]-block[base_idx + (4 * stride1) + (-3 * stride2)]-block_neg_center[border_idx_1 + (3 * stride1) + (3 * stride2)]+block_neg_center[border_idx_1 + (3 * stride1) + (-3 * stride2)])+
		    L44*(block[base_idx + (4 * stride1) + (4 * stride2)]-block[base_idx + (4 * stride1) + (-4 * stride2)]-block_neg_center[border_idx_1 + (3 * stride1) + (4 * stride2)]+block_neg_center[border_idx_1 + (3 * stride1) + (-4 * stride2)]))*(dinv)
		);
    case 1:
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-1 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-1 * stride2)])+
		    L14*(block[base_idx + (1 * stride1) + (4 * stride2)]-block[base_idx + (1 * stride1) + (-4 * stride2)]-block[base_idx + (-1 * stride1) + (4 * stride2)]+block[base_idx + (-1 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-1 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-2 * stride2)])+
		    L23*(block[base_idx + (2 * stride1) + (3 * stride2)]-block[base_idx + (2 * stride1) + (-3 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (3 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (2 * stride2)]-block[base_idx + (3 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-2 * stride2)])+ 
		    L24*(block[base_idx + (2 * stride1) + (4 * stride2)]-block[base_idx + (2 * stride1) + (-4 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (4 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (2 * stride2)]-block[base_idx + (4 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-2 * stride2)])+ 
		    L33*(block[base_idx + (3 * stride1) + (3 * stride2)]-block[base_idx + (3 * stride1) + (-3 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (3 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-3 * stride2)])+
		    L34*(block[base_idx + (3 * stride1) + (4 * stride2)]-block[base_idx + (3 * stride1) + (-4 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (4 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (3 * stride2)]-block[base_idx + (4 * stride1) + (-3 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (3 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-3 * stride2)])+
		    L44*(block[base_idx + (4 * stride1) + (4 * stride2)]-block[base_idx + (4 * stride1) + (-4 * stride2)]-block_neg_center[border_idx_1 + (2 * stride1) + (4 * stride2)]+block_neg_center[border_idx_1 + (2 * stride1) + (-4 * stride2)]))*(dinv)
		);
    case 2:
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-1 * stride2)])+
		    L14*(block[base_idx + (1 * stride1) + (4 * stride2)]-block[base_idx + (1 * stride1) + (-4 * stride2)]-block[base_idx + (-1 * stride1) + (4 * stride2)]+block[base_idx + (-1 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-1 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block[base_idx + (2 * stride1) + (3 * stride2)]-block[base_idx + (2 * stride1) + (-3 * stride2)]-block[base_idx + (-2 * stride1) + (3 * stride2)]+block[base_idx + (-2 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (2 * stride2)]-block[base_idx + (3 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-2 * stride2)])+ 
		    L24*(block[base_idx + (2 * stride1) + (4 * stride2)]-block[base_idx + (2 * stride1) + (-4 * stride2)]-block[base_idx + (-2 * stride1) + (4 * stride2)]+block[base_idx + (-2 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (2 * stride2)]-block[base_idx + (4 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-2 * stride2)])+ 
		    L33*(block[base_idx + (3 * stride1) + (3 * stride2)]-block[base_idx + (3 * stride1) + (-3 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (3 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-3 * stride2)])+
		    L34*(block[base_idx + (3 * stride1) + (4 * stride2)]-block[base_idx + (3 * stride1) + (-4 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (4 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (3 * stride2)]-block[base_idx + (4 * stride1) + (-3 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (3 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-3 * stride2)])+
		    L44*(block[base_idx + (4 * stride1) + (4 * stride2)]-block[base_idx + (4 * stride1) + (-4 * stride2)]-block_neg_center[border_idx_1 + (1 * stride1) + (4 * stride2)]+block_neg_center[border_idx_1 + (1 * stride1) + (-4 * stride2)]))*(dinv)
		);
    case 3:
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block[base_idx + (1 * stride1) + (4 * stride2)]-block[base_idx + (1 * stride1) + (-4 * stride2)]-block[base_idx + (-1 * stride1) + (4 * stride2)]+block[base_idx + (-1 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-1 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (1 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-1 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block[base_idx + (2 * stride1) + (3 * stride2)]-block[base_idx + (2 * stride1) + (-3 * stride2)]-block[base_idx + (-2 * stride1) + (3 * stride2)]+block[base_idx + (-2 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (2 * stride2)]-block[base_idx + (3 * stride1) + (-2 * stride2)]-block[base_idx + (-3 * stride1) + (2 * stride2)]+block[base_idx + (-3 * stride1) + (-2 * stride2)])+ 
		    L24*(block[base_idx + (2 * stride1) + (4 * stride2)]-block[base_idx + (2 * stride1) + (-4 * stride2)]-block[base_idx + (-2 * stride1) + (4 * stride2)]+block[base_idx + (-2 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (2 * stride2)]-block[base_idx + (4 * stride1) + (-2 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (2 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-2 * stride2)])+ 
		    L33*(block[base_idx + (3 * stride1) + (3 * stride2)]-block[base_idx + (3 * stride1) + (-3 * stride2)]-block[base_idx + (-3 * stride1) + (3 * stride2)]+block[base_idx + (-3 * stride1) + (-3 * stride2)])+
		    L34*(block[base_idx + (3 * stride1) + (4 * stride2)]-block[base_idx + (3 * stride1) + (-4 * stride2)]-block[base_idx + (-3 * stride1) + (4 * stride2)]+block[base_idx + (-3 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (3 * stride2)]-block[base_idx + (4 * stride1) + (-3 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (3 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-3 * stride2)])+
		    L44*(block[base_idx + (4 * stride1) + (4 * stride2)]-block[base_idx + (4 * stride1) + (-4 * stride2)]-block_neg_center[border_idx_1 + (0 * stride1) + (4 * stride2)]+block_neg_center[border_idx_1 + (0 * stride1) + (-4 * stride2)]))*(dinv)
		);
	default: UNREACHABLE;
	}
}

FP cross_deriv_pos_neg(
    const FP* block, const size_t base_idx,
    const size_t dir1, const FP* block_neg_center, const FP* block_pos_center, const int stride1,
    const size_t dir2, const FP* block_center_neg, const FP* block_center_pos, const int stride2,
    const FP* block_pos_pos, const FP* block_pos_neg, 
    const FP* block_neg_pos, const FP* block_neg_neg,
    const int cube_width, const FP dinv
){	
	const int depth1 = cube_width - 1 - dir1;
	const size_t border_idx_1 = flip(cube_width - 1, base_idx + depth1 * stride1, stride1, cube_width);
	
	const int depth2 = dir2;
	const size_t border_idx_2 = flip(0, base_idx - depth2 * stride2, stride2, cube_width);
	
	const size_t border_idx_3 = flip(0, border_idx_1 - depth2 * stride2, stride2, cube_width);
    switch (BITMASK_PAIR(depth1, depth2)){
    case BITMASK_PAIR(0, 0):
		return (
		    (L11*(block_pos_center[border_idx_1 + (0 * stride1) + (1 * stride2)]-block_pos_neg[border_idx_3 + (0 * stride1) + (0 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (0 * stride2)])+
		    L12*(block_pos_center[border_idx_1 + (0 * stride1) + (2 * stride2)]-block_pos_neg[border_idx_3 + (0 * stride1) + (1 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (1 * stride2)]-block_pos_neg[border_idx_3 + (1 * stride1) + (0 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (0 * stride2)])+
		    L13*(block_pos_center[border_idx_1 + (0 * stride1) + (3 * stride2)]-block_pos_neg[border_idx_3 + (0 * stride1) + (2 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (2 * stride2)]+block_pos_center[border_idx_1 + (2 * stride1) + (1 * stride2)]-block_pos_neg[border_idx_3 + (2 * stride1) + (0 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (0 * stride2)])+
		    L14*(block_pos_center[border_idx_1 + (0 * stride1) + (4 * stride2)]-block_pos_neg[border_idx_3 + (0 * stride1) + (3 * stride2)]-block[base_idx + (-1 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (3 * stride2)]+block_pos_center[border_idx_1 + (3 * stride1) + (1 * stride2)]-block_pos_neg[border_idx_3 + (3 * stride1) + (0 * stride2)]-block[base_idx + (-4 * stride1) + (1 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (0 * stride2)])+
		    L22*(block_pos_center[border_idx_1 + (1 * stride1) + (2 * stride2)]-block_pos_neg[border_idx_3 + (1 * stride1) + (1 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (1 * stride2)])+
		    L23*(block_pos_center[border_idx_1 + (1 * stride1) + (3 * stride2)]-block_pos_neg[border_idx_3 + (1 * stride1) + (2 * stride2)]-block[base_idx + (-2 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (2 * stride2)]+block_pos_center[border_idx_1 + (2 * stride1) + (2 * stride2)]-block_pos_neg[border_idx_3 + (2 * stride1) + (1 * stride2)]-block[base_idx + (-3 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (1 * stride2)])+ 
		    L24*(block_pos_center[border_idx_1 + (1 * stride1) + (4 * stride2)]-block_pos_neg[border_idx_3 + (1 * stride1) + (3 * stride2)]-block[base_idx + (-2 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (3 * stride2)]+block_pos_center[border_idx_1 + (3 * stride1) + (2 * stride2)]-block_pos_neg[border_idx_3 + (3 * stride1) + (1 * stride2)]-block[base_idx + (-4 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (1 * stride2)])+ 
		    L33*(block_pos_center[border_idx_1 + (2 * stride1) + (3 * stride2)]-block_pos_neg[border_idx_3 + (2 * stride1) + (2 * stride2)]-block[base_idx + (-3 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (2 * stride2)])+
		    L34*(block_pos_center[border_idx_1 + (2 * stride1) + (4 * stride2)]-block_pos_neg[border_idx_3 + (2 * stride1) + (3 * stride2)]-block[base_idx + (-3 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (3 * stride2)]+block_pos_center[border_idx_1 + (3 * stride1) + (3 * stride2)]-block_pos_neg[border_idx_3 + (3 * stride1) + (2 * stride2)]-block[base_idx + (-4 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (2 * stride2)])+
		    L44*(block_pos_center[border_idx_1 + (3 * stride1) + (4 * stride2)]-block_pos_neg[border_idx_3 + (3 * stride1) + (3 * stride2)]-block[base_idx + (-4 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (3 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(0, 1):
		return (
		    (L11*(block_pos_center[border_idx_1 + (0 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block_pos_center[border_idx_1 + (0 * stride1) + (2 * stride2)]-block_pos_neg[border_idx_3 + (0 * stride1) + (0 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block_pos_center[border_idx_1 + (0 * stride1) + (3 * stride2)]-block_pos_neg[border_idx_3 + (0 * stride1) + (1 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block_pos_center[border_idx_1 + (2 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block_pos_center[border_idx_1 + (0 * stride1) + (4 * stride2)]-block_pos_neg[border_idx_3 + (0 * stride1) + (2 * stride2)]-block[base_idx + (-1 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (2 * stride2)]+block_pos_center[border_idx_1 + (3 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (3 * stride1) + (-1 * stride2)]-block[base_idx + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-1 * stride2)])+
		    L22*(block_pos_center[border_idx_1 + (1 * stride1) + (2 * stride2)]-block_pos_neg[border_idx_3 + (1 * stride1) + (0 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (0 * stride2)])+
		    L23*(block_pos_center[border_idx_1 + (1 * stride1) + (3 * stride2)]-block_pos_neg[border_idx_3 + (1 * stride1) + (1 * stride2)]-block[base_idx + (-2 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (1 * stride2)]+block_pos_center[border_idx_1 + (2 * stride1) + (2 * stride2)]-block_pos_neg[border_idx_3 + (2 * stride1) + (0 * stride2)]-block[base_idx + (-3 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (0 * stride2)])+ 
		    L24*(block_pos_center[border_idx_1 + (1 * stride1) + (4 * stride2)]-block_pos_neg[border_idx_3 + (1 * stride1) + (2 * stride2)]-block[base_idx + (-2 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (2 * stride2)]+block_pos_center[border_idx_1 + (3 * stride1) + (2 * stride2)]-block_pos_neg[border_idx_3 + (3 * stride1) + (0 * stride2)]-block[base_idx + (-4 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (0 * stride2)])+ 
		    L33*(block_pos_center[border_idx_1 + (2 * stride1) + (3 * stride2)]-block_pos_neg[border_idx_3 + (2 * stride1) + (1 * stride2)]-block[base_idx + (-3 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (1 * stride2)])+
		    L34*(block_pos_center[border_idx_1 + (2 * stride1) + (4 * stride2)]-block_pos_neg[border_idx_3 + (2 * stride1) + (2 * stride2)]-block[base_idx + (-3 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (2 * stride2)]+block_pos_center[border_idx_1 + (3 * stride1) + (3 * stride2)]-block_pos_neg[border_idx_3 + (3 * stride1) + (1 * stride2)]-block[base_idx + (-4 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (1 * stride2)])+
		    L44*(block_pos_center[border_idx_1 + (3 * stride1) + (4 * stride2)]-block_pos_neg[border_idx_3 + (3 * stride1) + (2 * stride2)]-block[base_idx + (-4 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (2 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(0, 2):
		return (
		    (L11*(block_pos_center[border_idx_1 + (0 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block_pos_center[border_idx_1 + (0 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-2 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block_pos_center[border_idx_1 + (0 * stride1) + (3 * stride2)]-block_pos_neg[border_idx_3 + (0 * stride1) + (0 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block_pos_center[border_idx_1 + (2 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block_pos_center[border_idx_1 + (0 * stride1) + (4 * stride2)]-block_pos_neg[border_idx_3 + (0 * stride1) + (1 * stride2)]-block[base_idx + (-1 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block_pos_center[border_idx_1 + (3 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (3 * stride1) + (-1 * stride2)]-block[base_idx + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-1 * stride2)])+
		    L22*(block_pos_center[border_idx_1 + (1 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block_pos_center[border_idx_1 + (1 * stride1) + (3 * stride2)]-block_pos_neg[border_idx_3 + (1 * stride1) + (0 * stride2)]-block[base_idx + (-2 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (0 * stride2)]+block_pos_center[border_idx_1 + (2 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-2 * stride2)]-block[base_idx + (-3 * stride1) + (2 * stride2)]+block[base_idx + (-3 * stride1) + (-2 * stride2)])+ 
		    L24*(block_pos_center[border_idx_1 + (1 * stride1) + (4 * stride2)]-block_pos_neg[border_idx_3 + (1 * stride1) + (1 * stride2)]-block[base_idx + (-2 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (1 * stride2)]+block_pos_center[border_idx_1 + (3 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (3 * stride1) + (-2 * stride2)]-block[base_idx + (-4 * stride1) + (2 * stride2)]+block[base_idx + (-4 * stride1) + (-2 * stride2)])+ 
		    L33*(block_pos_center[border_idx_1 + (2 * stride1) + (3 * stride2)]-block_pos_neg[border_idx_3 + (2 * stride1) + (0 * stride2)]-block[base_idx + (-3 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (0 * stride2)])+
		    L34*(block_pos_center[border_idx_1 + (2 * stride1) + (4 * stride2)]-block_pos_neg[border_idx_3 + (2 * stride1) + (1 * stride2)]-block[base_idx + (-3 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (1 * stride2)]+block_pos_center[border_idx_1 + (3 * stride1) + (3 * stride2)]-block_pos_neg[border_idx_3 + (3 * stride1) + (0 * stride2)]-block[base_idx + (-4 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (0 * stride2)])+
		    L44*(block_pos_center[border_idx_1 + (3 * stride1) + (4 * stride2)]-block_pos_neg[border_idx_3 + (3 * stride1) + (1 * stride2)]-block[base_idx + (-4 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (1 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(0, 3):
		return (
		    (L11*(block_pos_center[border_idx_1 + (0 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block_pos_center[border_idx_1 + (0 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-2 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block_pos_center[border_idx_1 + (0 * stride1) + (3 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-3 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block_pos_center[border_idx_1 + (2 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block_pos_center[border_idx_1 + (0 * stride1) + (4 * stride2)]-block_pos_neg[border_idx_3 + (0 * stride1) + (0 * stride2)]-block[base_idx + (-1 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block_pos_center[border_idx_1 + (3 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (3 * stride1) + (-1 * stride2)]-block[base_idx + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-1 * stride2)])+
		    L22*(block_pos_center[border_idx_1 + (1 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block_pos_center[border_idx_1 + (1 * stride1) + (3 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-3 * stride2)]-block[base_idx + (-2 * stride1) + (3 * stride2)]+block[base_idx + (-2 * stride1) + (-3 * stride2)]+block_pos_center[border_idx_1 + (2 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-2 * stride2)]-block[base_idx + (-3 * stride1) + (2 * stride2)]+block[base_idx + (-3 * stride1) + (-2 * stride2)])+ 
		    L24*(block_pos_center[border_idx_1 + (1 * stride1) + (4 * stride2)]-block_pos_neg[border_idx_3 + (1 * stride1) + (0 * stride2)]-block[base_idx + (-2 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (0 * stride2)]+block_pos_center[border_idx_1 + (3 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (3 * stride1) + (-2 * stride2)]-block[base_idx + (-4 * stride1) + (2 * stride2)]+block[base_idx + (-4 * stride1) + (-2 * stride2)])+ 
		    L33*(block_pos_center[border_idx_1 + (2 * stride1) + (3 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-3 * stride2)]-block[base_idx + (-3 * stride1) + (3 * stride2)]+block[base_idx + (-3 * stride1) + (-3 * stride2)])+
		    L34*(block_pos_center[border_idx_1 + (2 * stride1) + (4 * stride2)]-block_pos_neg[border_idx_3 + (2 * stride1) + (0 * stride2)]-block[base_idx + (-3 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (0 * stride2)]+block_pos_center[border_idx_1 + (3 * stride1) + (3 * stride2)]-block_pos_center[border_idx_1 + (3 * stride1) + (-3 * stride2)]-block[base_idx + (-4 * stride1) + (3 * stride2)]+block[base_idx + (-4 * stride1) + (-3 * stride2)])+
		    L44*(block_pos_center[border_idx_1 + (3 * stride1) + (4 * stride2)]-block_pos_neg[border_idx_3 + (3 * stride1) + (0 * stride2)]-block[base_idx + (-4 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (0 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(1, 0):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (0 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (1 * stride2)]-block_pos_neg[border_idx_3 + (0 * stride1) + (0 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (0 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (2 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (2 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (1 * stride2)]-block_pos_neg[border_idx_3 + (1 * stride1) + (0 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (0 * stride2)])+
		    L14*(block[base_idx + (1 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (3 * stride2)]-block[base_idx + (-1 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (3 * stride2)]+block_pos_center[border_idx_1 + (2 * stride1) + (1 * stride2)]-block_pos_neg[border_idx_3 + (2 * stride1) + (0 * stride2)]-block[base_idx + (-4 * stride1) + (1 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (0 * stride2)])+
		    L22*(block_pos_center[border_idx_1 + (0 * stride1) + (2 * stride2)]-block_pos_neg[border_idx_3 + (0 * stride1) + (1 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (1 * stride2)])+
		    L23*(block_pos_center[border_idx_1 + (0 * stride1) + (3 * stride2)]-block_pos_neg[border_idx_3 + (0 * stride1) + (2 * stride2)]-block[base_idx + (-2 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (2 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (2 * stride2)]-block_pos_neg[border_idx_3 + (1 * stride1) + (1 * stride2)]-block[base_idx + (-3 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (1 * stride2)])+ 
		    L24*(block_pos_center[border_idx_1 + (0 * stride1) + (4 * stride2)]-block_pos_neg[border_idx_3 + (0 * stride1) + (3 * stride2)]-block[base_idx + (-2 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (3 * stride2)]+block_pos_center[border_idx_1 + (2 * stride1) + (2 * stride2)]-block_pos_neg[border_idx_3 + (2 * stride1) + (1 * stride2)]-block[base_idx + (-4 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (1 * stride2)])+ 
		    L33*(block_pos_center[border_idx_1 + (1 * stride1) + (3 * stride2)]-block_pos_neg[border_idx_3 + (1 * stride1) + (2 * stride2)]-block[base_idx + (-3 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (2 * stride2)])+
		    L34*(block_pos_center[border_idx_1 + (1 * stride1) + (4 * stride2)]-block_pos_neg[border_idx_3 + (1 * stride1) + (3 * stride2)]-block[base_idx + (-3 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (3 * stride2)]+block_pos_center[border_idx_1 + (2 * stride1) + (3 * stride2)]-block_pos_neg[border_idx_3 + (2 * stride1) + (2 * stride2)]-block[base_idx + (-4 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (2 * stride2)])+
		    L44*(block_pos_center[border_idx_1 + (2 * stride1) + (4 * stride2)]-block_pos_neg[border_idx_3 + (2 * stride1) + (3 * stride2)]-block[base_idx + (-4 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (3 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(1, 1):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block[base_idx + (1 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (2 * stride2)]-block[base_idx + (-1 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (2 * stride2)]+block_pos_center[border_idx_1 + (2 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-1 * stride2)])+
		    L22*(block_pos_center[border_idx_1 + (0 * stride1) + (2 * stride2)]-block_pos_neg[border_idx_3 + (0 * stride1) + (0 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (0 * stride2)])+
		    L23*(block_pos_center[border_idx_1 + (0 * stride1) + (3 * stride2)]-block_pos_neg[border_idx_3 + (0 * stride1) + (1 * stride2)]-block[base_idx + (-2 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (1 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (2 * stride2)]-block_pos_neg[border_idx_3 + (1 * stride1) + (0 * stride2)]-block[base_idx + (-3 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (0 * stride2)])+ 
		    L24*(block_pos_center[border_idx_1 + (0 * stride1) + (4 * stride2)]-block_pos_neg[border_idx_3 + (0 * stride1) + (2 * stride2)]-block[base_idx + (-2 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (2 * stride2)]+block_pos_center[border_idx_1 + (2 * stride1) + (2 * stride2)]-block_pos_neg[border_idx_3 + (2 * stride1) + (0 * stride2)]-block[base_idx + (-4 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (0 * stride2)])+ 
		    L33*(block_pos_center[border_idx_1 + (1 * stride1) + (3 * stride2)]-block_pos_neg[border_idx_3 + (1 * stride1) + (1 * stride2)]-block[base_idx + (-3 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (1 * stride2)])+
		    L34*(block_pos_center[border_idx_1 + (1 * stride1) + (4 * stride2)]-block_pos_neg[border_idx_3 + (1 * stride1) + (2 * stride2)]-block[base_idx + (-3 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (2 * stride2)]+block_pos_center[border_idx_1 + (2 * stride1) + (3 * stride2)]-block_pos_neg[border_idx_3 + (2 * stride1) + (1 * stride2)]-block[base_idx + (-4 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (1 * stride2)])+
		    L44*(block_pos_center[border_idx_1 + (2 * stride1) + (4 * stride2)]-block_pos_neg[border_idx_3 + (2 * stride1) + (2 * stride2)]-block[base_idx + (-4 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (2 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(1, 2):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block[base_idx + (1 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (-1 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block_pos_center[border_idx_1 + (2 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-1 * stride2)])+
		    L22*(block_pos_center[border_idx_1 + (0 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-2 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block_pos_center[border_idx_1 + (0 * stride1) + (3 * stride2)]-block_pos_neg[border_idx_3 + (0 * stride1) + (0 * stride2)]-block[base_idx + (-2 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (0 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-3 * stride1) + (2 * stride2)]+block[base_idx + (-3 * stride1) + (-2 * stride2)])+ 
		    L24*(block_pos_center[border_idx_1 + (0 * stride1) + (4 * stride2)]-block_pos_neg[border_idx_3 + (0 * stride1) + (1 * stride2)]-block[base_idx + (-2 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (1 * stride2)]+block_pos_center[border_idx_1 + (2 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-2 * stride2)]-block[base_idx + (-4 * stride1) + (2 * stride2)]+block[base_idx + (-4 * stride1) + (-2 * stride2)])+ 
		    L33*(block_pos_center[border_idx_1 + (1 * stride1) + (3 * stride2)]-block_pos_neg[border_idx_3 + (1 * stride1) + (0 * stride2)]-block[base_idx + (-3 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (0 * stride2)])+
		    L34*(block_pos_center[border_idx_1 + (1 * stride1) + (4 * stride2)]-block_pos_neg[border_idx_3 + (1 * stride1) + (1 * stride2)]-block[base_idx + (-3 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (1 * stride2)]+block_pos_center[border_idx_1 + (2 * stride1) + (3 * stride2)]-block_pos_neg[border_idx_3 + (2 * stride1) + (0 * stride2)]-block[base_idx + (-4 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (0 * stride2)])+
		    L44*(block_pos_center[border_idx_1 + (2 * stride1) + (4 * stride2)]-block_pos_neg[border_idx_3 + (2 * stride1) + (1 * stride2)]-block[base_idx + (-4 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (1 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(1, 3):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block[base_idx + (1 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (-1 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block_pos_center[border_idx_1 + (2 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-1 * stride2)])+
		    L22*(block_pos_center[border_idx_1 + (0 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-2 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block_pos_center[border_idx_1 + (0 * stride1) + (3 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-3 * stride2)]-block[base_idx + (-2 * stride1) + (3 * stride2)]+block[base_idx + (-2 * stride1) + (-3 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-3 * stride1) + (2 * stride2)]+block[base_idx + (-3 * stride1) + (-2 * stride2)])+ 
		    L24*(block_pos_center[border_idx_1 + (0 * stride1) + (4 * stride2)]-block_pos_neg[border_idx_3 + (0 * stride1) + (0 * stride2)]-block[base_idx + (-2 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (0 * stride2)]+block_pos_center[border_idx_1 + (2 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-2 * stride2)]-block[base_idx + (-4 * stride1) + (2 * stride2)]+block[base_idx + (-4 * stride1) + (-2 * stride2)])+ 
		    L33*(block_pos_center[border_idx_1 + (1 * stride1) + (3 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-3 * stride2)]-block[base_idx + (-3 * stride1) + (3 * stride2)]+block[base_idx + (-3 * stride1) + (-3 * stride2)])+
		    L34*(block_pos_center[border_idx_1 + (1 * stride1) + (4 * stride2)]-block_pos_neg[border_idx_3 + (1 * stride1) + (0 * stride2)]-block[base_idx + (-3 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (0 * stride2)]+block_pos_center[border_idx_1 + (2 * stride1) + (3 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-3 * stride2)]-block[base_idx + (-4 * stride1) + (3 * stride2)]+block[base_idx + (-4 * stride1) + (-3 * stride2)])+
		    L44*(block_pos_center[border_idx_1 + (2 * stride1) + (4 * stride2)]-block_pos_neg[border_idx_3 + (2 * stride1) + (0 * stride2)]-block[base_idx + (-4 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (0 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(2, 0):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (0 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (0 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (2 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (2 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (1 * stride2)]-block_pos_neg[border_idx_3 + (0 * stride1) + (0 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (0 * stride2)])+
		    L14*(block[base_idx + (1 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (3 * stride2)]-block[base_idx + (-1 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (3 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (1 * stride2)]-block_pos_neg[border_idx_3 + (1 * stride1) + (0 * stride2)]-block[base_idx + (-4 * stride1) + (1 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (0 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (1 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (1 * stride2)])+
		    L23*(block[base_idx + (2 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (2 * stride2)]-block[base_idx + (-2 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (2 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (2 * stride2)]-block_pos_neg[border_idx_3 + (0 * stride1) + (1 * stride2)]-block[base_idx + (-3 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (1 * stride2)])+ 
		    L24*(block[base_idx + (2 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (3 * stride2)]-block[base_idx + (-2 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (3 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (2 * stride2)]-block_pos_neg[border_idx_3 + (1 * stride1) + (1 * stride2)]-block[base_idx + (-4 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (1 * stride2)])+ 
		    L33*(block_pos_center[border_idx_1 + (0 * stride1) + (3 * stride2)]-block_pos_neg[border_idx_3 + (0 * stride1) + (2 * stride2)]-block[base_idx + (-3 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (2 * stride2)])+
		    L34*(block_pos_center[border_idx_1 + (0 * stride1) + (4 * stride2)]-block_pos_neg[border_idx_3 + (0 * stride1) + (3 * stride2)]-block[base_idx + (-3 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (3 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (3 * stride2)]-block_pos_neg[border_idx_3 + (1 * stride1) + (2 * stride2)]-block[base_idx + (-4 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (2 * stride2)])+
		    L44*(block_pos_center[border_idx_1 + (1 * stride1) + (4 * stride2)]-block_pos_neg[border_idx_3 + (1 * stride1) + (3 * stride2)]-block[base_idx + (-4 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (3 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(2, 1):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-1 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block[base_idx + (1 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (2 * stride2)]-block[base_idx + (-1 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (2 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-1 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (0 * stride2)])+
		    L23*(block[base_idx + (2 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (1 * stride2)]-block[base_idx + (-2 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (1 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (2 * stride2)]-block_pos_neg[border_idx_3 + (0 * stride1) + (0 * stride2)]-block[base_idx + (-3 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (0 * stride2)])+ 
		    L24*(block[base_idx + (2 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (2 * stride2)]-block[base_idx + (-2 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (2 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (2 * stride2)]-block_pos_neg[border_idx_3 + (1 * stride1) + (0 * stride2)]-block[base_idx + (-4 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (0 * stride2)])+ 
		    L33*(block_pos_center[border_idx_1 + (0 * stride1) + (3 * stride2)]-block_pos_neg[border_idx_3 + (0 * stride1) + (1 * stride2)]-block[base_idx + (-3 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (1 * stride2)])+
		    L34*(block_pos_center[border_idx_1 + (0 * stride1) + (4 * stride2)]-block_pos_neg[border_idx_3 + (0 * stride1) + (2 * stride2)]-block[base_idx + (-3 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (2 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (3 * stride2)]-block_pos_neg[border_idx_3 + (1 * stride1) + (1 * stride2)]-block[base_idx + (-4 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (1 * stride2)])+
		    L44*(block_pos_center[border_idx_1 + (1 * stride1) + (4 * stride2)]-block_pos_neg[border_idx_3 + (1 * stride1) + (2 * stride2)]-block[base_idx + (-4 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (2 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(2, 2):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-1 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block[base_idx + (1 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (-1 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-1 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block[base_idx + (2 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (-2 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (0 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-2 * stride2)]-block[base_idx + (-3 * stride1) + (2 * stride2)]+block[base_idx + (-3 * stride1) + (-2 * stride2)])+ 
		    L24*(block[base_idx + (2 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (1 * stride2)]-block[base_idx + (-2 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (1 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-4 * stride1) + (2 * stride2)]+block[base_idx + (-4 * stride1) + (-2 * stride2)])+ 
		    L33*(block_pos_center[border_idx_1 + (0 * stride1) + (3 * stride2)]-block_pos_neg[border_idx_3 + (0 * stride1) + (0 * stride2)]-block[base_idx + (-3 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (0 * stride2)])+
		    L34*(block_pos_center[border_idx_1 + (0 * stride1) + (4 * stride2)]-block_pos_neg[border_idx_3 + (0 * stride1) + (1 * stride2)]-block[base_idx + (-3 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (1 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (3 * stride2)]-block_pos_neg[border_idx_3 + (1 * stride1) + (0 * stride2)]-block[base_idx + (-4 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (0 * stride2)])+
		    L44*(block_pos_center[border_idx_1 + (1 * stride1) + (4 * stride2)]-block_pos_neg[border_idx_3 + (1 * stride1) + (1 * stride2)]-block[base_idx + (-4 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (1 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(2, 3):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-1 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block[base_idx + (1 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (-1 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-1 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block[base_idx + (2 * stride1) + (3 * stride2)]-block[base_idx + (2 * stride1) + (-3 * stride2)]-block[base_idx + (-2 * stride1) + (3 * stride2)]+block[base_idx + (-2 * stride1) + (-3 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-2 * stride2)]-block[base_idx + (-3 * stride1) + (2 * stride2)]+block[base_idx + (-3 * stride1) + (-2 * stride2)])+ 
		    L24*(block[base_idx + (2 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (-2 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (0 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-4 * stride1) + (2 * stride2)]+block[base_idx + (-4 * stride1) + (-2 * stride2)])+ 
		    L33*(block_pos_center[border_idx_1 + (0 * stride1) + (3 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-3 * stride2)]-block[base_idx + (-3 * stride1) + (3 * stride2)]+block[base_idx + (-3 * stride1) + (-3 * stride2)])+
		    L34*(block_pos_center[border_idx_1 + (0 * stride1) + (4 * stride2)]-block_pos_neg[border_idx_3 + (0 * stride1) + (0 * stride2)]-block[base_idx + (-3 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (0 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (3 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-3 * stride2)]-block[base_idx + (-4 * stride1) + (3 * stride2)]+block[base_idx + (-4 * stride1) + (-3 * stride2)])+
		    L44*(block_pos_center[border_idx_1 + (1 * stride1) + (4 * stride2)]-block_pos_neg[border_idx_3 + (1 * stride1) + (0 * stride2)]-block[base_idx + (-4 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (0 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(3, 0):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (0 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (0 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (2 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (2 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (0 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (0 * stride2)])+
		    L14*(block[base_idx + (1 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (3 * stride2)]-block[base_idx + (-1 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (3 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (1 * stride2)]-block_pos_neg[border_idx_3 + (0 * stride1) + (0 * stride2)]-block[base_idx + (-4 * stride1) + (1 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (0 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (1 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (1 * stride2)])+
		    L23*(block[base_idx + (2 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (2 * stride2)]-block[base_idx + (-2 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (2 * stride2)]+block[base_idx + (3 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (1 * stride2)]-block[base_idx + (-3 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (1 * stride2)])+ 
		    L24*(block[base_idx + (2 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (3 * stride2)]-block[base_idx + (-2 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (3 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (2 * stride2)]-block_pos_neg[border_idx_3 + (0 * stride1) + (1 * stride2)]-block[base_idx + (-4 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (1 * stride2)])+ 
		    L33*(block[base_idx + (3 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (2 * stride2)]-block[base_idx + (-3 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (2 * stride2)])+
		    L34*(block[base_idx + (3 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (3 * stride2)]-block[base_idx + (-3 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (3 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (3 * stride2)]-block_pos_neg[border_idx_3 + (0 * stride1) + (2 * stride2)]-block[base_idx + (-4 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (2 * stride2)])+
		    L44*(block_pos_center[border_idx_1 + (0 * stride1) + (4 * stride2)]-block_pos_neg[border_idx_3 + (0 * stride1) + (3 * stride2)]-block[base_idx + (-4 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (3 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(3, 1):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block[base_idx + (1 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (2 * stride2)]-block[base_idx + (-1 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (2 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-1 * stride2)]-block[base_idx + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-1 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (0 * stride2)])+
		    L23*(block[base_idx + (2 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (1 * stride2)]-block[base_idx + (-2 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (1 * stride2)]+block[base_idx + (3 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (0 * stride2)]-block[base_idx + (-3 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (0 * stride2)])+ 
		    L24*(block[base_idx + (2 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (2 * stride2)]-block[base_idx + (-2 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (2 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (2 * stride2)]-block_pos_neg[border_idx_3 + (0 * stride1) + (0 * stride2)]-block[base_idx + (-4 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (0 * stride2)])+ 
		    L33*(block[base_idx + (3 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (1 * stride2)]-block[base_idx + (-3 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (1 * stride2)])+
		    L34*(block[base_idx + (3 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (2 * stride2)]-block[base_idx + (-3 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (2 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (3 * stride2)]-block_pos_neg[border_idx_3 + (0 * stride1) + (1 * stride2)]-block[base_idx + (-4 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (1 * stride2)])+
		    L44*(block_pos_center[border_idx_1 + (0 * stride1) + (4 * stride2)]-block_pos_neg[border_idx_3 + (0 * stride1) + (2 * stride2)]-block[base_idx + (-4 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (2 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(3, 2):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block[base_idx + (1 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (-1 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-1 * stride2)]-block[base_idx + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-1 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block[base_idx + (2 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (-2 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (0 * stride2)]+block[base_idx + (3 * stride1) + (2 * stride2)]-block[base_idx + (3 * stride1) + (-2 * stride2)]-block[base_idx + (-3 * stride1) + (2 * stride2)]+block[base_idx + (-3 * stride1) + (-2 * stride2)])+ 
		    L24*(block[base_idx + (2 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (1 * stride2)]-block[base_idx + (-2 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (1 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-2 * stride2)]-block[base_idx + (-4 * stride1) + (2 * stride2)]+block[base_idx + (-4 * stride1) + (-2 * stride2)])+ 
		    L33*(block[base_idx + (3 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (0 * stride2)]-block[base_idx + (-3 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (0 * stride2)])+
		    L34*(block[base_idx + (3 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (1 * stride2)]-block[base_idx + (-3 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (1 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (3 * stride2)]-block_pos_neg[border_idx_3 + (0 * stride1) + (0 * stride2)]-block[base_idx + (-4 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (0 * stride2)])+
		    L44*(block_pos_center[border_idx_1 + (0 * stride1) + (4 * stride2)]-block_pos_neg[border_idx_3 + (0 * stride1) + (1 * stride2)]-block[base_idx + (-4 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (1 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(3, 3):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block[base_idx + (1 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (-1 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-1 * stride2)]-block[base_idx + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-1 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block[base_idx + (2 * stride1) + (3 * stride2)]-block[base_idx + (2 * stride1) + (-3 * stride2)]-block[base_idx + (-2 * stride1) + (3 * stride2)]+block[base_idx + (-2 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (2 * stride2)]-block[base_idx + (3 * stride1) + (-2 * stride2)]-block[base_idx + (-3 * stride1) + (2 * stride2)]+block[base_idx + (-3 * stride1) + (-2 * stride2)])+ 
		    L24*(block[base_idx + (2 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (-2 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (0 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-2 * stride2)]-block[base_idx + (-4 * stride1) + (2 * stride2)]+block[base_idx + (-4 * stride1) + (-2 * stride2)])+ 
		    L33*(block[base_idx + (3 * stride1) + (3 * stride2)]-block[base_idx + (3 * stride1) + (-3 * stride2)]-block[base_idx + (-3 * stride1) + (3 * stride2)]+block[base_idx + (-3 * stride1) + (-3 * stride2)])+
		    L34*(block[base_idx + (3 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (0 * stride2)]-block[base_idx + (-3 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (0 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (3 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-3 * stride2)]-block[base_idx + (-4 * stride1) + (3 * stride2)]+block[base_idx + (-4 * stride1) + (-3 * stride2)])+
		    L44*(block_pos_center[border_idx_1 + (0 * stride1) + (4 * stride2)]-block_pos_neg[border_idx_3 + (0 * stride1) + (0 * stride2)]-block[base_idx + (-4 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (0 * stride2)]))*(dinv)
		);
	default: UNREACHABLE; 
	}
}

FP cross_deriv_pos_pos(
    const FP* block, const size_t base_idx,
    const size_t dir1, const FP* block_neg_center, const FP* block_pos_center, const int stride1,
    const size_t dir2, const FP* block_center_neg, const FP* block_center_pos, const int stride2,
    const FP* block_pos_pos, const FP* block_pos_neg, 
    const FP* block_neg_pos, const FP* block_neg_neg,
    const int cube_width, const FP dinv
){	
	const int depth1 = cube_width - 1 - dir1;
	const size_t border_idx_1 = flip(cube_width - 1, base_idx + depth1 * stride1, stride1, cube_width);
	
	const int depth2 = cube_width - 1 - dir2;
	const size_t border_idx_2 = flip(cube_width - 1, base_idx + depth2 * stride2, stride2, cube_width);
	
	const size_t border_idx_3 = flip(cube_width - 1, border_idx_1 + depth2 * stride2, stride2, cube_width);
    switch (BITMASK_PAIR(depth1, depth2)){
    case BITMASK_PAIR(0, 0):
		return (
		    (L11*(block_pos_pos[border_idx_3 + (0 * stride1) + (0 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-1 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block_pos_pos[border_idx_3 + (0 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block_pos_pos[border_idx_3 + (1 * stride1) + (0 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-1 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (0 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block_pos_pos[border_idx_3 + (0 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block_pos_pos[border_idx_3 + (2 * stride1) + (0 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-1 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (0 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block_pos_pos[border_idx_3 + (0 * stride1) + (3 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (3 * stride2)]+block[base_idx + (-1 * stride1) + (-4 * stride2)]+block_pos_pos[border_idx_3 + (3 * stride1) + (0 * stride2)]-block_pos_center[border_idx_1 + (3 * stride1) + (-1 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (0 * stride2)]+block[base_idx + (-4 * stride1) + (-1 * stride2)])+
		    L22*(block_pos_pos[border_idx_3 + (1 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block_pos_pos[border_idx_3 + (1 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-3 * stride2)]+block_pos_pos[border_idx_3 + (2 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-2 * stride2)])+ 
		    L24*(block_pos_pos[border_idx_3 + (1 * stride1) + (3 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (3 * stride2)]+block[base_idx + (-2 * stride1) + (-4 * stride2)]+block_pos_pos[border_idx_3 + (3 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (3 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-2 * stride2)])+ 
		    L33*(block_pos_pos[border_idx_3 + (2 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (2 * stride2)]+block[base_idx + (-3 * stride1) + (-3 * stride2)])+
		    L34*(block_pos_pos[border_idx_3 + (2 * stride1) + (3 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (3 * stride2)]+block[base_idx + (-3 * stride1) + (-4 * stride2)]+block_pos_pos[border_idx_3 + (3 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (3 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (2 * stride2)]+block[base_idx + (-4 * stride1) + (-3 * stride2)])+
		    L44*(block_pos_pos[border_idx_3 + (3 * stride1) + (3 * stride2)]-block_pos_center[border_idx_1 + (3 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (3 * stride2)]+block[base_idx + (-4 * stride1) + (-4 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(0, 1):
		return (
		    (L11*(block_pos_center[border_idx_1 + (0 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block_pos_pos[border_idx_3 + (0 * stride1) + (0 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block_pos_pos[border_idx_3 + (0 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block_pos_center[border_idx_1 + (2 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block_pos_pos[border_idx_3 + (0 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-4 * stride2)]+block_pos_center[border_idx_1 + (3 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (3 * stride1) + (-1 * stride2)]-block[base_idx + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-1 * stride2)])+
		    L22*(block_pos_pos[border_idx_3 + (1 * stride1) + (0 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (0 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block_pos_pos[border_idx_3 + (1 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-3 * stride2)]+block_pos_pos[border_idx_3 + (2 * stride1) + (0 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (0 * stride2)]+block[base_idx + (-3 * stride1) + (-2 * stride2)])+ 
		    L24*(block_pos_pos[border_idx_3 + (1 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-4 * stride2)]+block_pos_pos[border_idx_3 + (3 * stride1) + (0 * stride2)]-block_pos_center[border_idx_1 + (3 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (0 * stride2)]+block[base_idx + (-4 * stride1) + (-2 * stride2)])+ 
		    L33*(block_pos_pos[border_idx_3 + (2 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-3 * stride2)])+
		    L34*(block_pos_pos[border_idx_3 + (2 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (2 * stride2)]+block[base_idx + (-3 * stride1) + (-4 * stride2)]+block_pos_pos[border_idx_3 + (3 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (3 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-3 * stride2)])+
		    L44*(block_pos_pos[border_idx_3 + (3 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (3 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (2 * stride2)]+block[base_idx + (-4 * stride1) + (-4 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(0, 2):
		return (
		    (L11*(block_pos_center[border_idx_1 + (0 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block_pos_center[border_idx_1 + (0 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-2 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block_pos_pos[border_idx_3 + (0 * stride1) + (0 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block_pos_center[border_idx_1 + (2 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block_pos_pos[border_idx_3 + (0 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-4 * stride2)]+block_pos_center[border_idx_1 + (3 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (3 * stride1) + (-1 * stride2)]-block[base_idx + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-1 * stride2)])+
		    L22*(block_pos_center[border_idx_1 + (1 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block_pos_pos[border_idx_3 + (1 * stride1) + (0 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (0 * stride2)]+block[base_idx + (-2 * stride1) + (-3 * stride2)]+block_pos_center[border_idx_1 + (2 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-2 * stride2)]-block[base_idx + (-3 * stride1) + (2 * stride2)]+block[base_idx + (-3 * stride1) + (-2 * stride2)])+ 
		    L24*(block_pos_pos[border_idx_3 + (1 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-4 * stride2)]+block_pos_center[border_idx_1 + (3 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (3 * stride1) + (-2 * stride2)]-block[base_idx + (-4 * stride1) + (2 * stride2)]+block[base_idx + (-4 * stride1) + (-2 * stride2)])+ 
		    L33*(block_pos_pos[border_idx_3 + (2 * stride1) + (0 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (0 * stride2)]+block[base_idx + (-3 * stride1) + (-3 * stride2)])+
		    L34*(block_pos_pos[border_idx_3 + (2 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-4 * stride2)]+block_pos_pos[border_idx_3 + (3 * stride1) + (0 * stride2)]-block_pos_center[border_idx_1 + (3 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (0 * stride2)]+block[base_idx + (-4 * stride1) + (-3 * stride2)])+
		    L44*(block_pos_pos[border_idx_3 + (3 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (3 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-4 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(0, 3):
		return (
		    (L11*(block_pos_center[border_idx_1 + (0 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block_pos_center[border_idx_1 + (0 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-2 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block_pos_center[border_idx_1 + (0 * stride1) + (3 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-3 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block_pos_center[border_idx_1 + (2 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block_pos_pos[border_idx_3 + (0 * stride1) + (0 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (-1 * stride1) + (-4 * stride2)]+block_pos_center[border_idx_1 + (3 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (3 * stride1) + (-1 * stride2)]-block[base_idx + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-1 * stride2)])+
		    L22*(block_pos_center[border_idx_1 + (1 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block_pos_center[border_idx_1 + (1 * stride1) + (3 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-3 * stride2)]-block[base_idx + (-2 * stride1) + (3 * stride2)]+block[base_idx + (-2 * stride1) + (-3 * stride2)]+block_pos_center[border_idx_1 + (2 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-2 * stride2)]-block[base_idx + (-3 * stride1) + (2 * stride2)]+block[base_idx + (-3 * stride1) + (-2 * stride2)])+ 
		    L24*(block_pos_pos[border_idx_3 + (1 * stride1) + (0 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (0 * stride2)]+block[base_idx + (-2 * stride1) + (-4 * stride2)]+block_pos_center[border_idx_1 + (3 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (3 * stride1) + (-2 * stride2)]-block[base_idx + (-4 * stride1) + (2 * stride2)]+block[base_idx + (-4 * stride1) + (-2 * stride2)])+ 
		    L33*(block_pos_center[border_idx_1 + (2 * stride1) + (3 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-3 * stride2)]-block[base_idx + (-3 * stride1) + (3 * stride2)]+block[base_idx + (-3 * stride1) + (-3 * stride2)])+
		    L34*(block_pos_pos[border_idx_3 + (2 * stride1) + (0 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (0 * stride2)]+block[base_idx + (-3 * stride1) + (-4 * stride2)]+block_pos_center[border_idx_1 + (3 * stride1) + (3 * stride2)]-block_pos_center[border_idx_1 + (3 * stride1) + (-3 * stride2)]-block[base_idx + (-4 * stride1) + (3 * stride2)]+block[base_idx + (-4 * stride1) + (-3 * stride2)])+
		    L44*(block_pos_pos[border_idx_3 + (3 * stride1) + (0 * stride2)]-block_pos_center[border_idx_1 + (3 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (0 * stride2)]+block[base_idx + (-4 * stride1) + (-4 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(1, 0):
		return (
		    (L11*(block_center_pos[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block_center_pos[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block_pos_pos[border_idx_3 + (0 * stride1) + (0 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-1 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (0 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block_center_pos[border_idx_2 + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block_pos_pos[border_idx_3 + (1 * stride1) + (0 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-1 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (0 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block_center_pos[border_idx_2 + (1 * stride1) + (3 * stride2)]-block[base_idx + (1 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (3 * stride2)]+block[base_idx + (-1 * stride1) + (-4 * stride2)]+block_pos_pos[border_idx_3 + (2 * stride1) + (0 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-1 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (0 * stride2)]+block[base_idx + (-4 * stride1) + (-1 * stride2)])+
		    L22*(block_pos_pos[border_idx_3 + (0 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block_pos_pos[border_idx_3 + (0 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-3 * stride2)]+block_pos_pos[border_idx_3 + (1 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-2 * stride2)])+ 
		    L24*(block_pos_pos[border_idx_3 + (0 * stride1) + (3 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (3 * stride2)]+block[base_idx + (-2 * stride1) + (-4 * stride2)]+block_pos_pos[border_idx_3 + (2 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-2 * stride2)])+ 
		    L33*(block_pos_pos[border_idx_3 + (1 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (2 * stride2)]+block[base_idx + (-3 * stride1) + (-3 * stride2)])+
		    L34*(block_pos_pos[border_idx_3 + (1 * stride1) + (3 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (3 * stride2)]+block[base_idx + (-3 * stride1) + (-4 * stride2)]+block_pos_pos[border_idx_3 + (2 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (2 * stride2)]+block[base_idx + (-4 * stride1) + (-3 * stride2)])+
		    L44*(block_pos_pos[border_idx_3 + (2 * stride1) + (3 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (3 * stride2)]+block[base_idx + (-4 * stride1) + (-4 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(1, 1):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block_center_pos[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block_center_pos[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block_center_pos[border_idx_2 + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-4 * stride2)]+block_pos_center[border_idx_1 + (2 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-1 * stride2)])+
		    L22*(block_pos_pos[border_idx_3 + (0 * stride1) + (0 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (0 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block_pos_pos[border_idx_3 + (0 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-3 * stride2)]+block_pos_pos[border_idx_3 + (1 * stride1) + (0 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (0 * stride2)]+block[base_idx + (-3 * stride1) + (-2 * stride2)])+ 
		    L24*(block_pos_pos[border_idx_3 + (0 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-4 * stride2)]+block_pos_pos[border_idx_3 + (2 * stride1) + (0 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (0 * stride2)]+block[base_idx + (-4 * stride1) + (-2 * stride2)])+ 
		    L33*(block_pos_pos[border_idx_3 + (1 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-3 * stride2)])+
		    L34*(block_pos_pos[border_idx_3 + (1 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (2 * stride2)]+block[base_idx + (-3 * stride1) + (-4 * stride2)]+block_pos_pos[border_idx_3 + (2 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-3 * stride2)])+
		    L44*(block_pos_pos[border_idx_3 + (2 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (2 * stride2)]+block[base_idx + (-4 * stride1) + (-4 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(1, 2):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block_center_pos[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block_center_pos[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-4 * stride2)]+block_pos_center[border_idx_1 + (2 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-1 * stride2)])+
		    L22*(block_pos_center[border_idx_1 + (0 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-2 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block_pos_pos[border_idx_3 + (0 * stride1) + (0 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (0 * stride2)]+block[base_idx + (-2 * stride1) + (-3 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-3 * stride1) + (2 * stride2)]+block[base_idx + (-3 * stride1) + (-2 * stride2)])+ 
		    L24*(block_pos_pos[border_idx_3 + (0 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-4 * stride2)]+block_pos_center[border_idx_1 + (2 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-2 * stride2)]-block[base_idx + (-4 * stride1) + (2 * stride2)]+block[base_idx + (-4 * stride1) + (-2 * stride2)])+ 
		    L33*(block_pos_pos[border_idx_3 + (1 * stride1) + (0 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (0 * stride2)]+block[base_idx + (-3 * stride1) + (-3 * stride2)])+
		    L34*(block_pos_pos[border_idx_3 + (1 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-4 * stride2)]+block_pos_pos[border_idx_3 + (2 * stride1) + (0 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (0 * stride2)]+block[base_idx + (-4 * stride1) + (-3 * stride2)])+
		    L44*(block_pos_pos[border_idx_3 + (2 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-4 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(1, 3):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block_center_pos[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (1 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (-1 * stride1) + (-4 * stride2)]+block_pos_center[border_idx_1 + (2 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-1 * stride2)])+
		    L22*(block_pos_center[border_idx_1 + (0 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-2 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block_pos_center[border_idx_1 + (0 * stride1) + (3 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-3 * stride2)]-block[base_idx + (-2 * stride1) + (3 * stride2)]+block[base_idx + (-2 * stride1) + (-3 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-3 * stride1) + (2 * stride2)]+block[base_idx + (-3 * stride1) + (-2 * stride2)])+ 
		    L24*(block_pos_pos[border_idx_3 + (0 * stride1) + (0 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (0 * stride2)]+block[base_idx + (-2 * stride1) + (-4 * stride2)]+block_pos_center[border_idx_1 + (2 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-2 * stride2)]-block[base_idx + (-4 * stride1) + (2 * stride2)]+block[base_idx + (-4 * stride1) + (-2 * stride2)])+ 
		    L33*(block_pos_center[border_idx_1 + (1 * stride1) + (3 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-3 * stride2)]-block[base_idx + (-3 * stride1) + (3 * stride2)]+block[base_idx + (-3 * stride1) + (-3 * stride2)])+
		    L34*(block_pos_pos[border_idx_3 + (1 * stride1) + (0 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (0 * stride2)]+block[base_idx + (-3 * stride1) + (-4 * stride2)]+block_pos_center[border_idx_1 + (2 * stride1) + (3 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-3 * stride2)]-block[base_idx + (-4 * stride1) + (3 * stride2)]+block[base_idx + (-4 * stride1) + (-3 * stride2)])+
		    L44*(block_pos_pos[border_idx_3 + (2 * stride1) + (0 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (0 * stride2)]+block[base_idx + (-4 * stride1) + (-4 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(2, 0):
		return (
		    (L11*(block_center_pos[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block_center_pos[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block_center_pos[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (0 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block_center_pos[border_idx_2 + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block_pos_pos[border_idx_3 + (0 * stride1) + (0 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-1 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (0 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block_center_pos[border_idx_2 + (1 * stride1) + (3 * stride2)]-block[base_idx + (1 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (3 * stride2)]+block[base_idx + (-1 * stride1) + (-4 * stride2)]+block_pos_pos[border_idx_3 + (1 * stride1) + (0 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-1 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (0 * stride2)]+block[base_idx + (-4 * stride1) + (-1 * stride2)])+
		    L22*(block_center_pos[border_idx_2 + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block_center_pos[border_idx_2 + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-3 * stride2)]+block_pos_pos[border_idx_3 + (0 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-2 * stride2)])+ 
		    L24*(block_center_pos[border_idx_2 + (2 * stride1) + (3 * stride2)]-block[base_idx + (2 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (3 * stride2)]+block[base_idx + (-2 * stride1) + (-4 * stride2)]+block_pos_pos[border_idx_3 + (1 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-2 * stride2)])+ 
		    L33*(block_pos_pos[border_idx_3 + (0 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (2 * stride2)]+block[base_idx + (-3 * stride1) + (-3 * stride2)])+
		    L34*(block_pos_pos[border_idx_3 + (0 * stride1) + (3 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (3 * stride2)]+block[base_idx + (-3 * stride1) + (-4 * stride2)]+block_pos_pos[border_idx_3 + (1 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (2 * stride2)]+block[base_idx + (-4 * stride1) + (-3 * stride2)])+
		    L44*(block_pos_pos[border_idx_3 + (1 * stride1) + (3 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (3 * stride2)]+block[base_idx + (-4 * stride1) + (-4 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(2, 1):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block_center_pos[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block_center_pos[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-1 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block_center_pos[border_idx_2 + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-4 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-1 * stride2)])+
		    L22*(block_center_pos[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (0 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block_center_pos[border_idx_2 + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-3 * stride2)]+block_pos_pos[border_idx_3 + (0 * stride1) + (0 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (0 * stride2)]+block[base_idx + (-3 * stride1) + (-2 * stride2)])+ 
		    L24*(block_center_pos[border_idx_2 + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-4 * stride2)]+block_pos_pos[border_idx_3 + (1 * stride1) + (0 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (0 * stride2)]+block[base_idx + (-4 * stride1) + (-2 * stride2)])+ 
		    L33*(block_pos_pos[border_idx_3 + (0 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-3 * stride2)])+
		    L34*(block_pos_pos[border_idx_3 + (0 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (2 * stride2)]+block[base_idx + (-3 * stride1) + (-4 * stride2)]+block_pos_pos[border_idx_3 + (1 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-3 * stride2)])+
		    L44*(block_pos_pos[border_idx_3 + (1 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (2 * stride2)]+block[base_idx + (-4 * stride1) + (-4 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(2, 2):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block_center_pos[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-1 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block_center_pos[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-4 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-1 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block_center_pos[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (2 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (0 * stride2)]+block[base_idx + (-2 * stride1) + (-3 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-2 * stride2)]-block[base_idx + (-3 * stride1) + (2 * stride2)]+block[base_idx + (-3 * stride1) + (-2 * stride2)])+ 
		    L24*(block_center_pos[border_idx_2 + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-4 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-4 * stride1) + (2 * stride2)]+block[base_idx + (-4 * stride1) + (-2 * stride2)])+ 
		    L33*(block_pos_pos[border_idx_3 + (0 * stride1) + (0 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (0 * stride2)]+block[base_idx + (-3 * stride1) + (-3 * stride2)])+
		    L34*(block_pos_pos[border_idx_3 + (0 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-4 * stride2)]+block_pos_pos[border_idx_3 + (1 * stride1) + (0 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (0 * stride2)]+block[base_idx + (-4 * stride1) + (-3 * stride2)])+
		    L44*(block_pos_pos[border_idx_3 + (1 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-4 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(2, 3):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-1 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block_center_pos[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (1 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (-1 * stride1) + (-4 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-1 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block[base_idx + (2 * stride1) + (3 * stride2)]-block[base_idx + (2 * stride1) + (-3 * stride2)]-block[base_idx + (-2 * stride1) + (3 * stride2)]+block[base_idx + (-2 * stride1) + (-3 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-2 * stride2)]-block[base_idx + (-3 * stride1) + (2 * stride2)]+block[base_idx + (-3 * stride1) + (-2 * stride2)])+ 
		    L24*(block_center_pos[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (2 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (0 * stride2)]+block[base_idx + (-2 * stride1) + (-4 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-4 * stride1) + (2 * stride2)]+block[base_idx + (-4 * stride1) + (-2 * stride2)])+ 
		    L33*(block_pos_center[border_idx_1 + (0 * stride1) + (3 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-3 * stride2)]-block[base_idx + (-3 * stride1) + (3 * stride2)]+block[base_idx + (-3 * stride1) + (-3 * stride2)])+
		    L34*(block_pos_pos[border_idx_3 + (0 * stride1) + (0 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (0 * stride2)]+block[base_idx + (-3 * stride1) + (-4 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (3 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-3 * stride2)]-block[base_idx + (-4 * stride1) + (3 * stride2)]+block[base_idx + (-4 * stride1) + (-3 * stride2)])+
		    L44*(block_pos_pos[border_idx_3 + (1 * stride1) + (0 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (0 * stride2)]+block[base_idx + (-4 * stride1) + (-4 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(3, 0):
		return (
		    (L11*(block_center_pos[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block_center_pos[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block_center_pos[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (0 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block_center_pos[border_idx_2 + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block_center_pos[border_idx_2 + (3 * stride1) + (0 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (0 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block_center_pos[border_idx_2 + (1 * stride1) + (3 * stride2)]-block[base_idx + (1 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (3 * stride2)]+block[base_idx + (-1 * stride1) + (-4 * stride2)]+block_pos_pos[border_idx_3 + (0 * stride1) + (0 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-1 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (0 * stride2)]+block[base_idx + (-4 * stride1) + (-1 * stride2)])+
		    L22*(block_center_pos[border_idx_2 + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block_center_pos[border_idx_2 + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-3 * stride2)]+block_center_pos[border_idx_2 + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-2 * stride2)])+ 
		    L24*(block_center_pos[border_idx_2 + (2 * stride1) + (3 * stride2)]-block[base_idx + (2 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (3 * stride2)]+block[base_idx + (-2 * stride1) + (-4 * stride2)]+block_pos_pos[border_idx_3 + (0 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-2 * stride2)])+ 
		    L33*(block_center_pos[border_idx_2 + (3 * stride1) + (2 * stride2)]-block[base_idx + (3 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (2 * stride2)]+block[base_idx + (-3 * stride1) + (-3 * stride2)])+
		    L34*(block_center_pos[border_idx_2 + (3 * stride1) + (3 * stride2)]-block[base_idx + (3 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (3 * stride2)]+block[base_idx + (-3 * stride1) + (-4 * stride2)]+block_pos_pos[border_idx_3 + (0 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (2 * stride2)]+block[base_idx + (-4 * stride1) + (-3 * stride2)])+
		    L44*(block_pos_pos[border_idx_3 + (0 * stride1) + (3 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (3 * stride2)]+block[base_idx + (-4 * stride1) + (-4 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(3, 1):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block_center_pos[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block_center_pos[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block_center_pos[border_idx_2 + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-4 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-1 * stride2)]-block[base_idx + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-1 * stride2)])+
		    L22*(block_center_pos[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (0 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block_center_pos[border_idx_2 + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-3 * stride2)]+block_center_pos[border_idx_2 + (3 * stride1) + (0 * stride2)]-block[base_idx + (3 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (0 * stride2)]+block[base_idx + (-3 * stride1) + (-2 * stride2)])+ 
		    L24*(block_center_pos[border_idx_2 + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-4 * stride2)]+block_pos_pos[border_idx_3 + (0 * stride1) + (0 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (0 * stride2)]+block[base_idx + (-4 * stride1) + (-2 * stride2)])+ 
		    L33*(block_center_pos[border_idx_2 + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-3 * stride2)])+
		    L34*(block_center_pos[border_idx_2 + (3 * stride1) + (2 * stride2)]-block[base_idx + (3 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (2 * stride2)]+block[base_idx + (-3 * stride1) + (-4 * stride2)]+block_pos_pos[border_idx_3 + (0 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-3 * stride2)])+
		    L44*(block_pos_pos[border_idx_3 + (0 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (2 * stride2)]+block[base_idx + (-4 * stride1) + (-4 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(3, 2):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block_center_pos[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block_center_pos[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-4 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-1 * stride2)]-block[base_idx + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-1 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block_center_pos[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (2 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (0 * stride2)]+block[base_idx + (-2 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (2 * stride2)]-block[base_idx + (3 * stride1) + (-2 * stride2)]-block[base_idx + (-3 * stride1) + (2 * stride2)]+block[base_idx + (-3 * stride1) + (-2 * stride2)])+ 
		    L24*(block_center_pos[border_idx_2 + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-4 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-2 * stride2)]-block[base_idx + (-4 * stride1) + (2 * stride2)]+block[base_idx + (-4 * stride1) + (-2 * stride2)])+ 
		    L33*(block_center_pos[border_idx_2 + (3 * stride1) + (0 * stride2)]-block[base_idx + (3 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (0 * stride2)]+block[base_idx + (-3 * stride1) + (-3 * stride2)])+
		    L34*(block_center_pos[border_idx_2 + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-4 * stride2)]+block_pos_pos[border_idx_3 + (0 * stride1) + (0 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (0 * stride2)]+block[base_idx + (-4 * stride1) + (-3 * stride2)])+
		    L44*(block_pos_pos[border_idx_3 + (0 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-4 * stride2)]))*(dinv)
		);
    case BITMASK_PAIR(3, 3):
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block_center_pos[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (1 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (-1 * stride1) + (-4 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-1 * stride2)]-block[base_idx + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-1 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block[base_idx + (2 * stride1) + (3 * stride2)]-block[base_idx + (2 * stride1) + (-3 * stride2)]-block[base_idx + (-2 * stride1) + (3 * stride2)]+block[base_idx + (-2 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (2 * stride2)]-block[base_idx + (3 * stride1) + (-2 * stride2)]-block[base_idx + (-3 * stride1) + (2 * stride2)]+block[base_idx + (-3 * stride1) + (-2 * stride2)])+ 
		    L24*(block_center_pos[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (2 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (0 * stride2)]+block[base_idx + (-2 * stride1) + (-4 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-2 * stride2)]-block[base_idx + (-4 * stride1) + (2 * stride2)]+block[base_idx + (-4 * stride1) + (-2 * stride2)])+ 
		    L33*(block[base_idx + (3 * stride1) + (3 * stride2)]-block[base_idx + (3 * stride1) + (-3 * stride2)]-block[base_idx + (-3 * stride1) + (3 * stride2)]+block[base_idx + (-3 * stride1) + (-3 * stride2)])+
		    L34*(block_center_pos[border_idx_2 + (3 * stride1) + (0 * stride2)]-block[base_idx + (3 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (0 * stride2)]+block[base_idx + (-3 * stride1) + (-4 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (3 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-3 * stride2)]-block[base_idx + (-4 * stride1) + (3 * stride2)]+block[base_idx + (-4 * stride1) + (-3 * stride2)])+
		    L44*(block_pos_pos[border_idx_3 + (0 * stride1) + (0 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (0 * stride2)]+block[base_idx + (-4 * stride1) + (-4 * stride2)]))*(dinv)
		);
	default: UNREACHABLE; 
	}
}

FP cross_deriv_pos_center(
    const FP* block, const size_t base_idx,
    const size_t dir1, const FP* block_neg_center, const FP* block_pos_center, const int stride1,
    const size_t dir2, const FP* block_center_neg, const FP* block_center_pos, const int stride2,
    const FP* block_pos_pos, const FP* block_pos_neg, 
    const FP* block_neg_pos, const FP* block_neg_neg,
    const int cube_width, const FP dinv
){	
	const int depth1 = cube_width - 1 - dir1;
	const size_t border_idx_1 = flip(cube_width - 1, base_idx + depth1 * stride1, stride1, cube_width);
    switch (depth1){
    case 0:
		return (
		    (L11*(block_pos_center[border_idx_1 + (0 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block_pos_center[border_idx_1 + (0 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-2 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block_pos_center[border_idx_1 + (0 * stride1) + (3 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-3 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block_pos_center[border_idx_1 + (2 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block_pos_center[border_idx_1 + (0 * stride1) + (4 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-4 * stride2)]-block[base_idx + (-1 * stride1) + (4 * stride2)]+block[base_idx + (-1 * stride1) + (-4 * stride2)]+block_pos_center[border_idx_1 + (3 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (3 * stride1) + (-1 * stride2)]-block[base_idx + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-1 * stride2)])+
		    L22*(block_pos_center[border_idx_1 + (1 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block_pos_center[border_idx_1 + (1 * stride1) + (3 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-3 * stride2)]-block[base_idx + (-2 * stride1) + (3 * stride2)]+block[base_idx + (-2 * stride1) + (-3 * stride2)]+block_pos_center[border_idx_1 + (2 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-2 * stride2)]-block[base_idx + (-3 * stride1) + (2 * stride2)]+block[base_idx + (-3 * stride1) + (-2 * stride2)])+ 
		    L24*(block_pos_center[border_idx_1 + (1 * stride1) + (4 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-4 * stride2)]-block[base_idx + (-2 * stride1) + (4 * stride2)]+block[base_idx + (-2 * stride1) + (-4 * stride2)]+block_pos_center[border_idx_1 + (3 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (3 * stride1) + (-2 * stride2)]-block[base_idx + (-4 * stride1) + (2 * stride2)]+block[base_idx + (-4 * stride1) + (-2 * stride2)])+ 
		    L33*(block_pos_center[border_idx_1 + (2 * stride1) + (3 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-3 * stride2)]-block[base_idx + (-3 * stride1) + (3 * stride2)]+block[base_idx + (-3 * stride1) + (-3 * stride2)])+
		    L34*(block_pos_center[border_idx_1 + (2 * stride1) + (4 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-4 * stride2)]-block[base_idx + (-3 * stride1) + (4 * stride2)]+block[base_idx + (-3 * stride1) + (-4 * stride2)]+block_pos_center[border_idx_1 + (3 * stride1) + (3 * stride2)]-block_pos_center[border_idx_1 + (3 * stride1) + (-3 * stride2)]-block[base_idx + (-4 * stride1) + (3 * stride2)]+block[base_idx + (-4 * stride1) + (-3 * stride2)])+
		    L44*(block_pos_center[border_idx_1 + (3 * stride1) + (4 * stride2)]-block_pos_center[border_idx_1 + (3 * stride1) + (-4 * stride2)]-block[base_idx + (-4 * stride1) + (4 * stride2)]+block[base_idx + (-4 * stride1) + (-4 * stride2)]))*(dinv)
		);
    case 1:
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block[base_idx + (1 * stride1) + (4 * stride2)]-block[base_idx + (1 * stride1) + (-4 * stride2)]-block[base_idx + (-1 * stride1) + (4 * stride2)]+block[base_idx + (-1 * stride1) + (-4 * stride2)]+block_pos_center[border_idx_1 + (2 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-1 * stride2)])+
		    L22*(block_pos_center[border_idx_1 + (0 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-2 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block_pos_center[border_idx_1 + (0 * stride1) + (3 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-3 * stride2)]-block[base_idx + (-2 * stride1) + (3 * stride2)]+block[base_idx + (-2 * stride1) + (-3 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-3 * stride1) + (2 * stride2)]+block[base_idx + (-3 * stride1) + (-2 * stride2)])+ 
		    L24*(block_pos_center[border_idx_1 + (0 * stride1) + (4 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-4 * stride2)]-block[base_idx + (-2 * stride1) + (4 * stride2)]+block[base_idx + (-2 * stride1) + (-4 * stride2)]+block_pos_center[border_idx_1 + (2 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-2 * stride2)]-block[base_idx + (-4 * stride1) + (2 * stride2)]+block[base_idx + (-4 * stride1) + (-2 * stride2)])+ 
		    L33*(block_pos_center[border_idx_1 + (1 * stride1) + (3 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-3 * stride2)]-block[base_idx + (-3 * stride1) + (3 * stride2)]+block[base_idx + (-3 * stride1) + (-3 * stride2)])+
		    L34*(block_pos_center[border_idx_1 + (1 * stride1) + (4 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-4 * stride2)]-block[base_idx + (-3 * stride1) + (4 * stride2)]+block[base_idx + (-3 * stride1) + (-4 * stride2)]+block_pos_center[border_idx_1 + (2 * stride1) + (3 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-3 * stride2)]-block[base_idx + (-4 * stride1) + (3 * stride2)]+block[base_idx + (-4 * stride1) + (-3 * stride2)])+
		    L44*(block_pos_center[border_idx_1 + (2 * stride1) + (4 * stride2)]-block_pos_center[border_idx_1 + (2 * stride1) + (-4 * stride2)]-block[base_idx + (-4 * stride1) + (4 * stride2)]+block[base_idx + (-4 * stride1) + (-4 * stride2)]))*(dinv)
		);
    case 2:
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-1 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block[base_idx + (1 * stride1) + (4 * stride2)]-block[base_idx + (1 * stride1) + (-4 * stride2)]-block[base_idx + (-1 * stride1) + (4 * stride2)]+block[base_idx + (-1 * stride1) + (-4 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-1 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block[base_idx + (2 * stride1) + (3 * stride2)]-block[base_idx + (2 * stride1) + (-3 * stride2)]-block[base_idx + (-2 * stride1) + (3 * stride2)]+block[base_idx + (-2 * stride1) + (-3 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-2 * stride2)]-block[base_idx + (-3 * stride1) + (2 * stride2)]+block[base_idx + (-3 * stride1) + (-2 * stride2)])+ 
		    L24*(block[base_idx + (2 * stride1) + (4 * stride2)]-block[base_idx + (2 * stride1) + (-4 * stride2)]-block[base_idx + (-2 * stride1) + (4 * stride2)]+block[base_idx + (-2 * stride1) + (-4 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-4 * stride1) + (2 * stride2)]+block[base_idx + (-4 * stride1) + (-2 * stride2)])+ 
		    L33*(block_pos_center[border_idx_1 + (0 * stride1) + (3 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-3 * stride2)]-block[base_idx + (-3 * stride1) + (3 * stride2)]+block[base_idx + (-3 * stride1) + (-3 * stride2)])+
		    L34*(block_pos_center[border_idx_1 + (0 * stride1) + (4 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-4 * stride2)]-block[base_idx + (-3 * stride1) + (4 * stride2)]+block[base_idx + (-3 * stride1) + (-4 * stride2)]+block_pos_center[border_idx_1 + (1 * stride1) + (3 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-3 * stride2)]-block[base_idx + (-4 * stride1) + (3 * stride2)]+block[base_idx + (-4 * stride1) + (-3 * stride2)])+
		    L44*(block_pos_center[border_idx_1 + (1 * stride1) + (4 * stride2)]-block_pos_center[border_idx_1 + (1 * stride1) + (-4 * stride2)]-block[base_idx + (-4 * stride1) + (4 * stride2)]+block[base_idx + (-4 * stride1) + (-4 * stride2)]))*(dinv)
		);
    case 3:
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block[base_idx + (1 * stride1) + (4 * stride2)]-block[base_idx + (1 * stride1) + (-4 * stride2)]-block[base_idx + (-1 * stride1) + (4 * stride2)]+block[base_idx + (-1 * stride1) + (-4 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (1 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-1 * stride2)]-block[base_idx + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-1 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block[base_idx + (2 * stride1) + (3 * stride2)]-block[base_idx + (2 * stride1) + (-3 * stride2)]-block[base_idx + (-2 * stride1) + (3 * stride2)]+block[base_idx + (-2 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (2 * stride2)]-block[base_idx + (3 * stride1) + (-2 * stride2)]-block[base_idx + (-3 * stride1) + (2 * stride2)]+block[base_idx + (-3 * stride1) + (-2 * stride2)])+ 
		    L24*(block[base_idx + (2 * stride1) + (4 * stride2)]-block[base_idx + (2 * stride1) + (-4 * stride2)]-block[base_idx + (-2 * stride1) + (4 * stride2)]+block[base_idx + (-2 * stride1) + (-4 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (2 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-2 * stride2)]-block[base_idx + (-4 * stride1) + (2 * stride2)]+block[base_idx + (-4 * stride1) + (-2 * stride2)])+ 
		    L33*(block[base_idx + (3 * stride1) + (3 * stride2)]-block[base_idx + (3 * stride1) + (-3 * stride2)]-block[base_idx + (-3 * stride1) + (3 * stride2)]+block[base_idx + (-3 * stride1) + (-3 * stride2)])+
		    L34*(block[base_idx + (3 * stride1) + (4 * stride2)]-block[base_idx + (3 * stride1) + (-4 * stride2)]-block[base_idx + (-3 * stride1) + (4 * stride2)]+block[base_idx + (-3 * stride1) + (-4 * stride2)]+block_pos_center[border_idx_1 + (0 * stride1) + (3 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-3 * stride2)]-block[base_idx + (-4 * stride1) + (3 * stride2)]+block[base_idx + (-4 * stride1) + (-3 * stride2)])+
		    L44*(block_pos_center[border_idx_1 + (0 * stride1) + (4 * stride2)]-block_pos_center[border_idx_1 + (0 * stride1) + (-4 * stride2)]-block[base_idx + (-4 * stride1) + (4 * stride2)]+block[base_idx + (-4 * stride1) + (-4 * stride2)]))*(dinv)
		);
	default: UNREACHABLE;
	}
}

FP cross_deriv_center_neg(
    const FP* block, const size_t base_idx,
    const size_t dir1, const FP* block_neg_center, const FP* block_pos_center, const int stride1,
    const size_t dir2, const FP* block_center_neg, const FP* block_center_pos, const int stride2,
    const FP* block_pos_pos, const FP* block_pos_neg, 
    const FP* block_neg_pos, const FP* block_neg_neg,
    const int cube_width, const FP dinv
){	
	const int depth2 = dir2;
	const size_t border_idx_2 = flip(0, base_idx - depth2 * stride2, stride2, cube_width);
    switch (depth2){
    case 0:
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (0 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (0 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (2 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (2 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (0 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (0 * stride2)])+
		    L14*(block[base_idx + (1 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (3 * stride2)]-block[base_idx + (-1 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (3 * stride2)]+block[base_idx + (4 * stride1) + (1 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (0 * stride2)]-block[base_idx + (-4 * stride1) + (1 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (0 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (1 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (1 * stride2)])+
		    L23*(block[base_idx + (2 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (2 * stride2)]-block[base_idx + (-2 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (2 * stride2)]+block[base_idx + (3 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (1 * stride2)]-block[base_idx + (-3 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (1 * stride2)])+ 
		    L24*(block[base_idx + (2 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (3 * stride2)]-block[base_idx + (-2 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (3 * stride2)]+block[base_idx + (4 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (1 * stride2)]-block[base_idx + (-4 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (1 * stride2)])+ 
		    L33*(block[base_idx + (3 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (2 * stride2)]-block[base_idx + (-3 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (2 * stride2)])+
		    L34*(block[base_idx + (3 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (3 * stride2)]-block[base_idx + (-3 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (3 * stride2)]+block[base_idx + (4 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (2 * stride2)]-block[base_idx + (-4 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (2 * stride2)])+
		    L44*(block[base_idx + (4 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (3 * stride2)]-block[base_idx + (-4 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (3 * stride2)]))*(dinv)
		);
    case 1:
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block[base_idx + (1 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (2 * stride2)]-block[base_idx + (-1 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (2 * stride2)]+block[base_idx + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-1 * stride2)]-block[base_idx + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-1 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (0 * stride2)])+
		    L23*(block[base_idx + (2 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (1 * stride2)]-block[base_idx + (-2 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (1 * stride2)]+block[base_idx + (3 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (0 * stride2)]-block[base_idx + (-3 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (0 * stride2)])+ 
		    L24*(block[base_idx + (2 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (2 * stride2)]-block[base_idx + (-2 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (2 * stride2)]+block[base_idx + (4 * stride1) + (2 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (0 * stride2)]-block[base_idx + (-4 * stride1) + (2 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (0 * stride2)])+ 
		    L33*(block[base_idx + (3 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (1 * stride2)]-block[base_idx + (-3 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (1 * stride2)])+
		    L34*(block[base_idx + (3 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (2 * stride2)]-block[base_idx + (-3 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (2 * stride2)]+block[base_idx + (4 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (1 * stride2)]-block[base_idx + (-4 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (1 * stride2)])+
		    L44*(block[base_idx + (4 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (2 * stride2)]-block[base_idx + (-4 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (2 * stride2)]))*(dinv)
		);
    case 2:
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block[base_idx + (1 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (-1 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block[base_idx + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-1 * stride2)]-block[base_idx + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-1 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block[base_idx + (2 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (-2 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (0 * stride2)]+block[base_idx + (3 * stride1) + (2 * stride2)]-block[base_idx + (3 * stride1) + (-2 * stride2)]-block[base_idx + (-3 * stride1) + (2 * stride2)]+block[base_idx + (-3 * stride1) + (-2 * stride2)])+ 
		    L24*(block[base_idx + (2 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (1 * stride2)]-block[base_idx + (-2 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (1 * stride2)]+block[base_idx + (4 * stride1) + (2 * stride2)]-block[base_idx + (4 * stride1) + (-2 * stride2)]-block[base_idx + (-4 * stride1) + (2 * stride2)]+block[base_idx + (-4 * stride1) + (-2 * stride2)])+ 
		    L33*(block[base_idx + (3 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (0 * stride2)]-block[base_idx + (-3 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (0 * stride2)])+
		    L34*(block[base_idx + (3 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (1 * stride2)]-block[base_idx + (-3 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (1 * stride2)]+block[base_idx + (4 * stride1) + (3 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (0 * stride2)]-block[base_idx + (-4 * stride1) + (3 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (0 * stride2)])+
		    L44*(block[base_idx + (4 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (1 * stride2)]-block[base_idx + (-4 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (1 * stride2)]))*(dinv)
		);
    case 3:
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block[base_idx + (1 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (-1 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-1 * stride2)]-block[base_idx + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-1 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block[base_idx + (2 * stride1) + (3 * stride2)]-block[base_idx + (2 * stride1) + (-3 * stride2)]-block[base_idx + (-2 * stride1) + (3 * stride2)]+block[base_idx + (-2 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (2 * stride2)]-block[base_idx + (3 * stride1) + (-2 * stride2)]-block[base_idx + (-3 * stride1) + (2 * stride2)]+block[base_idx + (-3 * stride1) + (-2 * stride2)])+ 
		    L24*(block[base_idx + (2 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (-2 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-2 * stride1) + (0 * stride2)]+block[base_idx + (4 * stride1) + (2 * stride2)]-block[base_idx + (4 * stride1) + (-2 * stride2)]-block[base_idx + (-4 * stride1) + (2 * stride2)]+block[base_idx + (-4 * stride1) + (-2 * stride2)])+ 
		    L33*(block[base_idx + (3 * stride1) + (3 * stride2)]-block[base_idx + (3 * stride1) + (-3 * stride2)]-block[base_idx + (-3 * stride1) + (3 * stride2)]+block[base_idx + (-3 * stride1) + (-3 * stride2)])+
		    L34*(block[base_idx + (3 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (3 * stride1) + (0 * stride2)]-block[base_idx + (-3 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-3 * stride1) + (0 * stride2)]+block[base_idx + (4 * stride1) + (3 * stride2)]-block[base_idx + (4 * stride1) + (-3 * stride2)]-block[base_idx + (-4 * stride1) + (3 * stride2)]+block[base_idx + (-4 * stride1) + (-3 * stride2)])+
		    L44*(block[base_idx + (4 * stride1) + (4 * stride2)]-block_center_neg[border_idx_2 + (4 * stride1) + (0 * stride2)]-block[base_idx + (-4 * stride1) + (4 * stride2)]+block_center_neg[border_idx_2 + (-4 * stride1) + (0 * stride2)]))*(dinv)
		);
	default: UNREACHABLE;
	}
}

FP cross_deriv_center_pos(
    const FP* block, const size_t base_idx,
    const size_t dir1, const FP* block_neg_center, const FP* block_pos_center, const int stride1,
    const size_t dir2, const FP* block_center_neg, const FP* block_center_pos, const int stride2,
    const FP* block_pos_pos, const FP* block_pos_neg, 
    const FP* block_neg_pos, const FP* block_neg_neg,
    const int cube_width, const FP dinv
){	
	const int depth2 = cube_width - 1 - dir2;
	const size_t border_idx_2 = flip(cube_width - 1, base_idx + depth2 * stride2, stride2, cube_width);
    switch (depth2){
    case 0:
		return (
		    (L11*(block_center_pos[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block_center_pos[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block_center_pos[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (0 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block_center_pos[border_idx_2 + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block_center_pos[border_idx_2 + (3 * stride1) + (0 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (0 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block_center_pos[border_idx_2 + (1 * stride1) + (3 * stride2)]-block[base_idx + (1 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (3 * stride2)]+block[base_idx + (-1 * stride1) + (-4 * stride2)]+block_center_pos[border_idx_2 + (4 * stride1) + (0 * stride2)]-block[base_idx + (4 * stride1) + (-1 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (0 * stride2)]+block[base_idx + (-4 * stride1) + (-1 * stride2)])+
		    L22*(block_center_pos[border_idx_2 + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block_center_pos[border_idx_2 + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-3 * stride2)]+block_center_pos[border_idx_2 + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-2 * stride2)])+ 
		    L24*(block_center_pos[border_idx_2 + (2 * stride1) + (3 * stride2)]-block[base_idx + (2 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (3 * stride2)]+block[base_idx + (-2 * stride1) + (-4 * stride2)]+block_center_pos[border_idx_2 + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-2 * stride2)])+ 
		    L33*(block_center_pos[border_idx_2 + (3 * stride1) + (2 * stride2)]-block[base_idx + (3 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (2 * stride2)]+block[base_idx + (-3 * stride1) + (-3 * stride2)])+
		    L34*(block_center_pos[border_idx_2 + (3 * stride1) + (3 * stride2)]-block[base_idx + (3 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (3 * stride2)]+block[base_idx + (-3 * stride1) + (-4 * stride2)]+block_center_pos[border_idx_2 + (4 * stride1) + (2 * stride2)]-block[base_idx + (4 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (2 * stride2)]+block[base_idx + (-4 * stride1) + (-3 * stride2)])+
		    L44*(block_center_pos[border_idx_2 + (4 * stride1) + (3 * stride2)]-block[base_idx + (4 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (3 * stride2)]+block[base_idx + (-4 * stride1) + (-4 * stride2)]))*(dinv)
		);
    case 1:
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block_center_pos[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block_center_pos[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block_center_pos[border_idx_2 + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-1 * stride2)]-block[base_idx + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-1 * stride2)])+
		    L22*(block_center_pos[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (0 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block_center_pos[border_idx_2 + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-3 * stride2)]+block_center_pos[border_idx_2 + (3 * stride1) + (0 * stride2)]-block[base_idx + (3 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (0 * stride2)]+block[base_idx + (-3 * stride1) + (-2 * stride2)])+ 
		    L24*(block_center_pos[border_idx_2 + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-4 * stride2)]+block_center_pos[border_idx_2 + (4 * stride1) + (0 * stride2)]-block[base_idx + (4 * stride1) + (-2 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (0 * stride2)]+block[base_idx + (-4 * stride1) + (-2 * stride2)])+ 
		    L33*(block_center_pos[border_idx_2 + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-3 * stride2)])+
		    L34*(block_center_pos[border_idx_2 + (3 * stride1) + (2 * stride2)]-block[base_idx + (3 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (2 * stride2)]+block[base_idx + (-3 * stride1) + (-4 * stride2)]+block_center_pos[border_idx_2 + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-3 * stride2)])+
		    L44*(block_center_pos[border_idx_2 + (4 * stride1) + (2 * stride2)]-block[base_idx + (4 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (2 * stride2)]+block[base_idx + (-4 * stride1) + (-4 * stride2)]))*(dinv)
		);
    case 2:
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block_center_pos[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block_center_pos[border_idx_2 + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-1 * stride2)]-block[base_idx + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-1 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block_center_pos[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (2 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (0 * stride2)]+block[base_idx + (-2 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (2 * stride2)]-block[base_idx + (3 * stride1) + (-2 * stride2)]-block[base_idx + (-3 * stride1) + (2 * stride2)]+block[base_idx + (-3 * stride1) + (-2 * stride2)])+ 
		    L24*(block_center_pos[border_idx_2 + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (2 * stride2)]-block[base_idx + (4 * stride1) + (-2 * stride2)]-block[base_idx + (-4 * stride1) + (2 * stride2)]+block[base_idx + (-4 * stride1) + (-2 * stride2)])+ 
		    L33*(block_center_pos[border_idx_2 + (3 * stride1) + (0 * stride2)]-block[base_idx + (3 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (0 * stride2)]+block[base_idx + (-3 * stride1) + (-3 * stride2)])+
		    L34*(block_center_pos[border_idx_2 + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-4 * stride2)]+block_center_pos[border_idx_2 + (4 * stride1) + (0 * stride2)]-block[base_idx + (4 * stride1) + (-3 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (0 * stride2)]+block[base_idx + (-4 * stride1) + (-3 * stride2)])+
		    L44*(block_center_pos[border_idx_2 + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-4 * stride2)]))*(dinv)
		);
    case 3:
		return (
		    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
		    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
		    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
		    L14*(block_center_pos[border_idx_2 + (1 * stride1) + (0 * stride2)]-block[base_idx + (1 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-1 * stride1) + (0 * stride2)]+block[base_idx + (-1 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-1 * stride2)]-block[base_idx + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-1 * stride2)])+
		    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
		    L23*(block[base_idx + (2 * stride1) + (3 * stride2)]-block[base_idx + (2 * stride1) + (-3 * stride2)]-block[base_idx + (-2 * stride1) + (3 * stride2)]+block[base_idx + (-2 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (2 * stride2)]-block[base_idx + (3 * stride1) + (-2 * stride2)]-block[base_idx + (-3 * stride1) + (2 * stride2)]+block[base_idx + (-3 * stride1) + (-2 * stride2)])+ 
		    L24*(block_center_pos[border_idx_2 + (2 * stride1) + (0 * stride2)]-block[base_idx + (2 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-2 * stride1) + (0 * stride2)]+block[base_idx + (-2 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (2 * stride2)]-block[base_idx + (4 * stride1) + (-2 * stride2)]-block[base_idx + (-4 * stride1) + (2 * stride2)]+block[base_idx + (-4 * stride1) + (-2 * stride2)])+ 
		    L33*(block[base_idx + (3 * stride1) + (3 * stride2)]-block[base_idx + (3 * stride1) + (-3 * stride2)]-block[base_idx + (-3 * stride1) + (3 * stride2)]+block[base_idx + (-3 * stride1) + (-3 * stride2)])+
		    L34*(block_center_pos[border_idx_2 + (3 * stride1) + (0 * stride2)]-block[base_idx + (3 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-3 * stride1) + (0 * stride2)]+block[base_idx + (-3 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (3 * stride2)]-block[base_idx + (4 * stride1) + (-3 * stride2)]-block[base_idx + (-4 * stride1) + (3 * stride2)]+block[base_idx + (-4 * stride1) + (-3 * stride2)])+
		    L44*(block_center_pos[border_idx_2 + (4 * stride1) + (0 * stride2)]-block[base_idx + (4 * stride1) + (-4 * stride2)]-block_center_pos[border_idx_2 + (-4 * stride1) + (0 * stride2)]+block[base_idx + (-4 * stride1) + (-4 * stride2)]))*(dinv)
		);
	default: UNREACHABLE;
	}
}

FP cross_deriv_center_center(
    const FP* block, const size_t base_idx,
    const size_t dir1, const FP* block_neg_center, const FP* block_pos_center, const int stride1,
    const size_t dir2, const FP* block_center_neg, const FP* block_center_pos, const int stride2,
    const FP* block_pos_pos, const FP* block_pos_neg, 
    const FP* block_neg_pos, const FP* block_neg_neg,
    const int cube_width, const FP dinv
){
    	return (
	    (L11*(block[base_idx + (1 * stride1) + (1 * stride2)]-block[base_idx + (1 * stride1) + (-1 * stride2)]-block[base_idx + (-1 * stride1) + (1 * stride2)]+block[base_idx + (-1 * stride1) + (-1 * stride2)])+
	    L12*(block[base_idx + (1 * stride1) + (2 * stride2)]-block[base_idx + (1 * stride1) + (-2 * stride2)]-block[base_idx + (-1 * stride1) + (2 * stride2)]+block[base_idx + (-1 * stride1) + (-2 * stride2)]+block[base_idx + (2 * stride1) + (1 * stride2)]-block[base_idx + (2 * stride1) + (-1 * stride2)]-block[base_idx + (-2 * stride1) + (1 * stride2)]+block[base_idx + (-2 * stride1) + (-1 * stride2)])+
	    L13*(block[base_idx + (1 * stride1) + (3 * stride2)]-block[base_idx + (1 * stride1) + (-3 * stride2)]-block[base_idx + (-1 * stride1) + (3 * stride2)]+block[base_idx + (-1 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (1 * stride2)]-block[base_idx + (3 * stride1) + (-1 * stride2)]-block[base_idx + (-3 * stride1) + (1 * stride2)]+block[base_idx + (-3 * stride1) + (-1 * stride2)])+
	    L14*(block[base_idx + (1 * stride1) + (4 * stride2)]-block[base_idx + (1 * stride1) + (-4 * stride2)]-block[base_idx + (-1 * stride1) + (4 * stride2)]+block[base_idx + (-1 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (1 * stride2)]-block[base_idx + (4 * stride1) + (-1 * stride2)]-block[base_idx + (-4 * stride1) + (1 * stride2)]+block[base_idx + (-4 * stride1) + (-1 * stride2)])+
	    L22*(block[base_idx + (2 * stride1) + (2 * stride2)]-block[base_idx + (2 * stride1) + (-2 * stride2)]-block[base_idx + (-2 * stride1) + (2 * stride2)]+block[base_idx + (-2 * stride1) + (-2 * stride2)])+
	    L23*(block[base_idx + (2 * stride1) + (3 * stride2)]-block[base_idx + (2 * stride1) + (-3 * stride2)]-block[base_idx + (-2 * stride1) + (3 * stride2)]+block[base_idx + (-2 * stride1) + (-3 * stride2)]+block[base_idx + (3 * stride1) + (2 * stride2)]-block[base_idx + (3 * stride1) + (-2 * stride2)]-block[base_idx + (-3 * stride1) + (2 * stride2)]+block[base_idx + (-3 * stride1) + (-2 * stride2)])+ 
	    L24*(block[base_idx + (2 * stride1) + (4 * stride2)]-block[base_idx + (2 * stride1) + (-4 * stride2)]-block[base_idx + (-2 * stride1) + (4 * stride2)]+block[base_idx + (-2 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (2 * stride2)]-block[base_idx + (4 * stride1) + (-2 * stride2)]-block[base_idx + (-4 * stride1) + (2 * stride2)]+block[base_idx + (-4 * stride1) + (-2 * stride2)])+ 
	    L33*(block[base_idx + (3 * stride1) + (3 * stride2)]-block[base_idx + (3 * stride1) + (-3 * stride2)]-block[base_idx + (-3 * stride1) + (3 * stride2)]+block[base_idx + (-3 * stride1) + (-3 * stride2)])+
	    L34*(block[base_idx + (3 * stride1) + (4 * stride2)]-block[base_idx + (3 * stride1) + (-4 * stride2)]-block[base_idx + (-3 * stride1) + (4 * stride2)]+block[base_idx + (-3 * stride1) + (-4 * stride2)]+block[base_idx + (4 * stride1) + (3 * stride2)]-block[base_idx + (4 * stride1) + (-3 * stride2)]-block[base_idx + (-4 * stride1) + (3 * stride2)]+block[base_idx + (-4 * stride1) + (-3 * stride2)])+
	    L44*(block[base_idx + (4 * stride1) + (4 * stride2)]-block[base_idx + (4 * stride1) + (-4 * stride2)]-block[base_idx + (-4 * stride1) + (4 * stride2)]+block[base_idx + (-4 * stride1) + (-4 * stride2)]))*(dinv)
	);
}
#undef MAX_MASK_NUM
